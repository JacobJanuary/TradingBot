# üîç –û–¢–ß–ï–¢ –ü–û –†–ê–°–°–õ–ï–î–û–í–ê–ù–ò–Æ –û–®–ò–ë–ö–ò BYBIT 'UNIFIED'

**–î–∞—Ç–∞**: 2025-10-18
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø
**–°—Ç–∞—Ç—É—Å**: –ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞, —Ä–µ—à–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ

---

## üìå –ö–†–ê–¢–ö–û–ï –†–ï–ó–Æ–ú–ï

–û—à–∏–±–∫–∞ `KeyError: 'unified'` –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑-–∑–∞ **–î–í–£–• –ù–ï–ó–ê–í–ò–°–ò–ú–´–• –ü–†–û–ë–õ–ï–ú**:

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–∏–º–≤–æ–ª–æ–≤**: –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `BTCUSDT` –≤–º–µ—Å—Ç–æ `BTC/USDT:USDT`
2. **–õ–æ–∂–Ω–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ –∫–ª—é—á–∞ 'unified'**: CCXT –¥–ª—è Bybit –ù–ï –¥–æ–±–∞–≤–ª—è–µ—Ç –∫–ª—é—á 'unified' –≤ market data

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê #1: –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô –§–û–†–ú–ê–¢ –°–ò–ú–í–û–õ–û–í

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
- –ë–æ—Ç –ø—ã—Ç–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Å–∏–º–≤–æ–ª–æ–º `IDEXUSDT`
- –¢–∞–∫–æ–≥–æ —Å–∏–º–≤–æ–ª–∞ –ù–ï –°–£–©–ï–°–¢–í–£–ï–¢ –Ω–∞ Bybit
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: `IDEX/USDT:USDT` (–¥–ª—è perpetual) –∏–ª–∏ `IDEX/USDT` (–¥–ª—è spot)

### –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏–∑ —Ç–µ—Å—Ç–æ–≤:
```
Symbols containing 'IDEX':
  ‚úÖ IDEX/USDT:USDT       type=swap   linear=True   # –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç

Testing symbol: IDEXUSDT
  ‚ö†Ô∏è  Symbol not found in markets              # –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
```

### –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –Ω–∞ Bybit:
- **Perpetual (futures)**: `BTC/USDT:USDT`, `ETH/USDT:USDT`, `IDEX/USDT:USDT`
- **Spot**: `BTC/USDT`, `ETH/USDT`, `XDC/USDT`
- **Inverse perpetual**: `BTC/USD:BTC`

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê #2: –û–®–ò–ë–ö–ê –í CCXT –ë–ò–ë–õ–ò–û–¢–ï–ö–ï

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
1. CCXT –≤—ã–∑—ã–≤–∞–µ—Ç `market[defaultType]` –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `price_to_precision()`
2. –ö–æ–¥ –æ–∂–∏–¥–∞–µ—Ç –∫–ª—é—á `'unified'` –∫–æ–≥–¥–∞ `defaultType = 'unified'`
3. –ù–û: Bybit market data –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª—é—á `'unified'`!

### –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:
```python
# –ò–∑ —Å—Ç–µ–∫-—Ç—Ä–µ–π—Å–∞:
File "ccxt/base/exchange.py", line 5075, in market
    if market[defaultType]:   # defaultType = 'unified'
       ~~~~~~^^^^^^^^^^^^^
KeyError: 'unified'
```

### –¢–µ—Å—Ç—ã –ø–æ–∫–∞–∑–∞–ª–∏:
```
Testing format: BTC/USDT:USDT
  ‚úÖ Found!
  ‚úÖ price_to_precision works: 45000.25 -> 45000.2
  ‚ö†Ô∏è 'unified' key NOT in market    # <-- –ö–ª—é—á–∞ –Ω–µ—Ç!
```

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ú–ò–ù–ò–ú–ê–õ–¨–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–ò–∑–º–µ–Ω–∏—Ç—å `defaultType` —Å `'unified'` –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ:

```python
# –í —Ñ–∞–π–ª–µ core/exchange_manager.py, —Å—Ç—Ä–æ–∫–∏ 111 –∏ 129
# –ë–´–õ–û:
exchange_options['options']['defaultType'] = 'unified'

# –°–¢–ê–õ–û:
exchange_options['options']['defaultType'] = 'swap'  # –∏–ª–∏ 'linear'
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–û–õ–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç —Å–∏–º–≤–æ–ª–æ–≤**:
```python
# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è Bybit
def convert_symbol_for_bybit(symbol: str, is_perpetual: bool = True) -> str:
    """
    –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç BTCUSDT -> BTC/USDT:USDT –¥–ª—è perpetual
    –∏–ª–∏ BTCUSDT -> BTC/USDT –¥–ª—è spot
    """
    if '/' in symbol:  # –£–∂–µ –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
        return symbol

    # –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º —á—Ç–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Å–∏–º–≤–æ–ª–∞ —ç—Ç–æ quote –≤–∞–ª—é—Ç–∞
    if symbol.endswith('USDT'):
        base = symbol[:-4]
        quote = 'USDT'
        if is_perpetual:
            return f"{base}/{quote}:{quote}"
        else:
            return f"{base}/{quote}"

    return symbol  # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å –µ—Å–ª–∏ –Ω–µ –º–æ–∂–µ–º —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å
```

2. **–ò–∑–º–µ–Ω–∏—Ç—å defaultType**:
```python
exchange_options['options']['defaultType'] = 'swap'  # –í–º–µ—Å—Ç–æ 'unified'
```

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–æ—Ç–æ—Ä—ã–µ –ù–ï –≤—ã–∑—ã–≤–∞—é—Ç –æ—à–∏–±–∫—É:
- ‚úÖ `defaultType: 'swap'` - —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ `defaultType: 'linear'` - —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ `defaultType: 'future'` - —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ë–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è defaultType - —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 'swap')

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É:
- ‚ùå `defaultType: 'unified'` - KeyError –ø—Ä–∏ –≤—ã–∑–æ–≤–µ price_to_precision()

---

## üéØ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### –®–∞–≥ 1: –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (1 –º–∏–Ω—É—Ç–∞)
```python
# –í —Ñ–∞–π–ª–µ core/exchange_manager.py
# –°—Ç—Ä–æ–∫–∞ 111: –∑–∞–º–µ–Ω–∏—Ç—å 'unified' –Ω–∞ 'swap'
exchange_options['options']['defaultType'] = 'swap'

# –°—Ç—Ä–æ–∫–∞ 129: –∑–∞–º–µ–Ω–∏—Ç—å 'unified' –Ω–∞ 'swap'
self.exchange.options['defaultType'] = 'swap'
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π –±–æ—Ç
pkill -f "python.*main.py"

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
python3 main.py --mode production
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∫–∞
- –î–æ–∂–¥–∞—Ç—å—Å—è —Å–ª–µ–¥—É—é—â–µ–π –≤–æ–ª–Ω—ã
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –ø–æ–∑–∏—Ü–∏–∏ –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –Ω–∞ Bybit
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ 'unified' –≤ –ª–æ–≥–∞—Ö

---

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. ‚úÖ Bybit –Ω–∞—á–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ
2. ‚úÖ 18 —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–∑–∏—Ü–∏–π –Ω–∞ Bybit —Å–º–æ–≥—É—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å—Å—è
3. ‚úÖ –ù–æ–≤—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –±—É–¥—É—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è –Ω–∞ Bybit
4. ‚úÖ –ò—Å—á–µ–∑–Ω—É—Ç –≤—Å–µ –æ—à–∏–±–∫–∏ `KeyError: 'unified'`

---

## üî¨ –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –í–µ—Ä—Å–∏–∏:
- **CCXT**: 4.4.8
- **pybit**: 5.8.0
- **Python**: 3.12

### –ü–æ—á–µ–º—É 'unified' –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- `'unified'` —ç—Ç–æ —Ç–∏–ø –∞–∫–∫–∞—É–Ω—Ç–∞ –≤ Bybit API, –ù–ï —Ç–∏–ø —Ä—ã–Ω–∫–∞
- CCXT –æ–∂–∏–¥–∞–µ—Ç market type: 'spot', 'swap', 'future', 'option', 'linear', 'inverse'
- –ö–æ–≥–¥–∞ CCXT –ø—ã—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å `market['unified']`, —Ç–∞–∫–æ–≥–æ –∫–ª—é—á–∞ –Ω–µ—Ç

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª—é—á–∏ –≤ Bybit market:
```python
market.keys() = ['spot', 'margin', 'swap', 'future', 'option', 'linear', 'inverse', ...]
# –ù–ï–¢ –∫–ª—é—á–∞ 'unified'!
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û–ï –ü–†–ò–ú–ï–ß–ê–ù–ò–ï

**–ù–ï –ù–£–ñ–ù–û**:
- –û–±–Ω–æ–≤–ª—è—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
- –ú–µ–Ω—è—Ç—å API –∫–ª—é—á–∏
- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –º–µ–∂–¥—É testnet/mainnet
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –±–æ–ª—å—à–∏–µ –∫—É—Å–∫–∏ –∫–æ–¥–∞

**–ù–£–ñ–ù–û –¢–û–õ–¨–ö–û**:
- –ò–∑–º–µ–Ω–∏—Ç—å 2 —Å—Ç—Ä–æ–∫–∏: –∑–∞–º–µ–Ω–∏—Ç—å `'unified'` –Ω–∞ `'swap'`

---

## –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–ü—Ä–æ–±–ª–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞. –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–≤—É—Ö —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞. –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è Bybit –Ω–∞—á–Ω–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ.