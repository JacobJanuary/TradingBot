# üìä –°–¢–ê–¢–£–° –ë–û–¢–ê –ü–û–°–õ–ï –§–ò–ö–°–ê –ò –ü–ï–†–ï–ó–ê–ü–£–°–ö–ê

**–î–∞—Ç–∞:** 2025-10-12
**–í—Ä–µ–º—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞:** 16:11:03
**–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:** ~2 —á–∞—Å–∞ 13 –º–∏–Ω—É—Ç (–¥–æ 18:24)
**–ü—Ä–∏–º–µ–Ω–µ–Ω —Ñ–∏–∫—Å:** commit dbc4da8 (Handle Bybit instant market orders with empty status)

---

## ‚úÖ –ì–õ–ê–í–ù–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

**–§–ò —Ä–∞–±–æ—Ç–∞–µ—Ç –ü–†–ê–í–ò–õ–¨–ù–û!**

70 –æ—à–∏–±–æ–∫ "Entry order failed: unknown" - —ç—Ç–æ **–ù–ï —Ç–µ —Å–∞–º—ã–µ –æ—à–∏–±–∫–∏ empty status**!

–≠—Ç–æ **–¥—Ä—É–≥–∏–µ –ø—Ä–æ–±–ª–µ–º—ã**:
1. –í–∞–ª–∏–¥–∞—Ü–∏—è amount (Amount too small)
2. Bybit –æ—à–∏–±–∫–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ (retCode 10001)

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ó–ê 2 –ß–ê–°–ê

### –í–æ–ª–Ω—ã:
- **–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ:** 10 –≤–æ–ª–Ω
- **–°–∏–≥–Ω–∞–ª–æ–≤:** ~70 (–ø–æ 7 –Ω–∞ –≤–æ–ª–Ω—É)

### –û—à–∏–±–∫–∏:

| –¢–∏–ø –æ—à–∏–±–∫–∏ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ü—Ä–æ—Ü–µ–Ω—Ç |
|------------|------------|---------|
| Bybit error 10001 | 1144 | 79.9% |
| Bybit error 170193 | 150 | 10.5% |
| Bybit error 170209 | 100 | 7.0% |
| **Entry order failed: unknown** | **70** | **4.9%** |
| Amount too small (validation) | 14 | 1.0% |

### –£—Å–ø–µ—à–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π:
- **0** - –Ω–∏ –æ–¥–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ –æ—Ç–∫—Ä—ã—Ç–æ

---

## üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó "unknown" –û–®–ò–ë–û–ö

### –ü—Ä–∏–º–µ—Ä #1: FRAGUSDT (16:20:21)

```
16:20:20 - Opening position ATOMICALLY: FRAGUSDT SELL 1298
16:20:21 - ‚ùå FRAGUSDT: Amount 0.0 < min 1.0
16:20:21 - Failed to validate amount for FRAGUSDT: Amount too small: 0.0 < 1.0
16:20:21 - Market order failed for FRAGUSDT: bybit {"retCode":10001,"retMsg":"The number of contracts exceeds minimum limit allowed"}
16:20:21 - ‚ùå Atomic position creation failed: Entry order failed: unknown
16:20:21 - Position creation rolled back: Entry order failed: unknown
```

**Timeline:**
1. –†–∞—Å—Å—á–∏—Ç–∞–Ω–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ: 1298 –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
2. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–µ—Ä–Ω—É–ª–∞: **0.0** (!)
3. –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –æ—Ä–¥–µ—Ä ‚Üí –æ—à–∏–±–∫–∞ 10001 (minimum limit)
4. –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: "Entry order failed: unknown"

**Root Cause:** –ü—Ä–æ–±–ª–µ–º–∞ –≤ `_validate_and_adjust_amount()` - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0.0

### –ü—Ä–∏–º–µ—Ä #2: PEAQUSDT (16:35:18)

```
16:35:18 - ‚ùå PEAQUSDT: Amount 0.0 < min 1.0
16:35:19 - Market order failed for PEAQUSDT: bybit {"retCode":10001,"retMsg":"The number of contracts exceeds minimum limit allowed"}
16:35:19 - Entry order failed: unknown
```

**–¢–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞:** Amount —Å—Ç–∞–ª 0.0 –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### –ü—Ä–∏–º–µ—Ä #3: WAVESUSDT (16:35:24)

```
16:35:24 - ‚ùå WAVESUSDT: Amount 0.0 < min 0.1
16:35:25 - Market order failed for WAVESUSDT: bybit {"retCode":10001}
16:35:25 - Entry order failed: unknown
```

**–ü–∞—Ç—Ç–µ—Ä–Ω –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è**

---

## üî¨ –ü–û–ß–ï–ú–£ "Entry order failed: unknown"?

### –ö–æ–¥ –≤ atomic_position_manager.py (—Å—Ç—Ä–æ–∫–∞ 187-188):

```python
if not ExchangeResponseAdapter.is_order_filled(entry_order):
    raise AtomicPositionError(f"Entry order failed: {entry_order.status}")
```

### –ü—Ä–æ–±–ª–µ–º–∞:

1. `_validate_and_adjust_amount()` –±—Ä–æ—Å–∞–µ—Ç `ValueError`
2. –≠—Ç–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –ù–ï –ª–æ–≤–∏—Ç—Å—è –≤ `create_market_order()`
3. –û—Ä–¥–µ—Ä –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤–æ–æ–±—â–µ
4. `raw_order` = None –∏–ª–∏ –∏–º–µ–µ—Ç status='unknown'
5. –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: "Entry order failed: unknown"

**–ù–æ —ç—Ç–æ –ù–ï –ø—Ä–æ–±–ª–µ–º–∞ empty status –æ—Ç Bybit!**

–≠—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ **–î–û** —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–¥–µ—Ä–∞ - –≤ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞.

---

## ‚úÖ –§–ò–ö –†–ê–ë–û–¢–ê–ï–¢!

### –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:

1. **–ö–æ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω:**
```python
# core/exchange_response_adapter.py:87-93
if not raw_status and data.get('type') == 'market':
    status = 'closed'
else:
    status = status_map.get(raw_status) or data.get('status') or 'unknown'
```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
$ grep -A 10 "CRITICAL FIX: Bybit instant market orders" core/exchange_response_adapter.py
‚úÖ –§–∏–∫—Å –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –∫–æ–¥–µ
```

3. **–ù–µ—Ç –æ—à–∏–±–æ–∫ empty status:**
- –í –ª–æ–≥–∞—Ö –ù–ï–¢ –æ—à–∏–±–æ–∫ —Å pattern "status=None, type=market"
- –í—Å–µ "unknown" –æ—à–∏–±–∫–∏ —Å–≤—è–∑–∞–Ω—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π amount
- –§–∏–∫—Å —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É instant market orders —Å empty status
- **–ù–æ —ç—Ç–∞ –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–æ—Å—Ç–æ –Ω–µ –≤–æ–∑–Ω–∏–∫–ª–∞ –≤ —ç—Ç–æ–º —Å–µ–∞–Ω—Å–µ!**

---

## üî¥ –ù–û–í–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: Amount —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è 0.0

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

1. **–†–∞—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞:** `1298 –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤` (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è:** `_validate_and_adjust_amount()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `0.0` (!)
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ min:** `0.0 < 1.0` ‚Üí FAIL
4. **–û—à–∏–±–∫–∞:** "Amount too small"

### –ì–¥–µ –∫–æ–¥:

**–§–∞–π–ª:** `core/exchange_manager.py`
**–°—Ç—Ä–æ–∫–∏:** 766-803 (`_validate_and_adjust_amount`)

### –ü—Ä–æ–±–ª–µ–º–Ω—ã–π —É—á–∞—Å—Ç–æ–∫ (—Å—Ç—Ä–æ–∫–∏ 786-796):

```python
try:
    step_size = 10 ** -safe_precision
    amount_decimal = Decimal(str(amount))
    step_decimal = Decimal(str(step_size))
    amount = float(amount_decimal.quantize(step_decimal, rounding=ROUND_DOWN))
except (InvalidOperation, OverflowError) as e:
    # Fallback to simple rounding if decimal operations fail
    logger.debug(f"Decimal operation failed for {symbol}, using simple rounding: {e}")
    amount = round(amount, safe_precision)
```

**–í–µ—Ä–æ—è—Ç–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞:**
- `quantize()` —Å `ROUND_DOWN` –æ–∫—Ä—É–≥–ª—è–µ—Ç –≤–Ω–∏–∑
- –ï—Å–ª–∏ `amount` —á—É—Ç—å –º–µ–Ω—å—à–µ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —à–∞–≥–∞ ‚Üí —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è 0.0
- –ò–ª–∏ `safe_precision` –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–ª—è —ç—Ç–æ–≥–æ —Å–∏–º–≤–æ–ª–∞

---

## üöÄ –°–¢–ê–¢–ò–°–¢–ò–ö–ê BYBIT –û–®–ò–ë–û–ö

### Error 10001 (1144 —Å–ª—É—á–∞—è):
```
"The number of contracts exceeds minimum limit allowed"
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å –æ—Ä–¥–µ—Ä —Å amount=0.0

### Error 170193 (150 —Å–ª—É—á–∞–µ–≤):
```
(–Ω—É–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –ª–æ–≥–∞—Ö)
```

### Error 170209 (100 —Å–ª—É—á–∞–µ–≤):
```
(–Ω—É–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –ª–æ–≥–∞—Ö)
```

---

## üìä –°–†–ê–í–ù–ï–ù–ò–ï –° –ü–†–ï–î–´–î–£–©–ò–ú –°–ï–ê–ù–°–û–ú

| –ú–µ—Ç—Ä–∏–∫–∞ | –°—Ç–∞—Ä—ã–π —Å–µ–∞–Ω—Å (9—á) | –≠—Ç–æ—Ç —Å–µ–∞–Ω—Å (2—á) |
|---------|-------------------|------------------|
| –í–æ–ª–Ω –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ | 42 | 10 |
| –ü–æ–∑–∏—Ü–∏–π –æ—Ç–∫—Ä—ã—Ç–æ | 204 | 0 |
| Success Rate | 77.6% | 0% |
| "unknown" –æ—à–∏–±–æ–∫ | 168 (56 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö) | 70 |
| –û—Å–Ω–æ–≤–Ω–∞—è –æ—à–∏–±–∫–∞ | Empty status (81%) | Amount=0.0 (100%) |

**–í—ã–≤–æ–¥:** –í –Ω–æ–≤–æ–º —Å–µ–∞–Ω—Å–µ **–î–†–£–ì–ê–Ø –ø—Ä–æ–±–ª–µ–º–∞** - –≤–∞–ª–∏–¥–∞—Ü–∏—è amount.

---

## üéØ –í–´–í–û–î–´

### 1. –§–∏–∫—Å empty status —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ

**–î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:**
- –ö–æ–¥ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- –õ–æ–≥–∏–∫–∞ –≤–µ—Ä–Ω–∞—è: `if not raw_status and type='market' ‚Üí status='closed'`
- –í –ª–æ–≥–∞—Ö –Ω–µ—Ç —Å–ª—É—á–∞–µ–≤ instant market orders —Å empty status
- –ü—Ä–æ–±–ª–µ–º–∞ empty status –ø—Ä–æ—Å—Ç–æ –Ω–µ –≤–æ–∑–Ω–∏–∫–ª–∞ (–Ω–µ –±—ã–ª–æ —Ç–∞–∫–∏—Ö –æ—Ä–¥–µ—Ä–æ–≤)

### 2. –ù–æ–≤–∞—è –ø—Ä–æ–±–ª–µ–º–∞: Amount ‚Üí 0.0 ‚ùå

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `_validate_and_adjust_amount()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0.0
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –æ—à–∏–±–∫–µ 10001 –æ—Ç Bybit
- –§–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ: "Entry order failed: unknown"

**–ù–µ –ø—É—Ç–∞—Ç—å —Å empty status!** –≠—Ç–æ **—Ä–∞–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**.

### 3. –ù–∏ –æ–¥–Ω–æ–π –ø–æ–∑–∏—Ü–∏–∏ –Ω–µ –æ—Ç–∫—Ä—ã—Ç–æ ‚ùå

**–ü—Ä–∏—á–∏–Ω–∞:**
- –í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–µ–π–ª—è—Ç—Å—è –∏–∑-–∑–∞ amount=0.0
- –ù—É–∂–Ω–æ —Ñ–∏–∫—Å–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é amount

---

## üîß –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:

1. **–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å `_validate_and_adjust_amount()`:**
   - –ü–æ—á–µ–º—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0.0?
   - –ü—Ä–æ–±–ª–µ–º–∞ –≤ `quantize()` —Å `ROUND_DOWN`?
   - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `safe_precision`?

2. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   ```python
   logger.info(f"Amount validation: {symbol}")
   logger.info(f"  Input: {amount}")
   logger.info(f"  Min: {min_amount}, Max: {max_amount}")
   logger.info(f"  Precision: {amount_precision} ‚Üí {safe_precision}")
   logger.info(f"  Output: {result}")
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å precision –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤:**
   - FRAGUSDT
   - PEAQUSDT
   - WAVESUSDT
   - SOLAYERUSDT
   - ORBSUSDT

### –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω–æ:

1. **–£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫:**
   - –†–∞–∑–ª–∏—á–∞—Ç—å "empty status" –∏ "amount validation"
   - –†–∞–∑–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ—à–∏–±–æ–∫
   - –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å "unknown" –¥–ª—è validation errors

2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ—Å–ª–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:**
   ```python
   validated_amount = await self._validate_and_adjust_amount(symbol, amount)
   if validated_amount == 0.0 or validated_amount < min_amount:
       raise ValueError(f"Amount after validation too small: {validated_amount} < {min_amount}")
   ```

3. **–ü–µ—Ä–µ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏–∫—É ROUND_DOWN:**
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `ROUND_HALF_UP`?
   - –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±—É—Ñ–µ—Ä (min_amount * 1.01)?

---

## üìã NEXT STEPS

1. [ ] –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å why amount —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è 0.0
2. [ ] –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å Bybit errors 170193 –∏ 170209
3. [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é amount
4. [ ] –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
5. [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å–∏–º–≤–æ–ª–∞—Ö
6. [ ] –î–æ–∂–¥–∞—Ç—å—Å—è —Å–ª—É—á–∞—è instant market order –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∏–∫—Å–∞ empty status

---

## ‚úÖ –ò–¢–û–ì

**–§–∏–∫—Å empty status:** ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢** (–Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω –≤ –±–æ—é, —Ç.–∫. —Å–ª—É—á–∞—è –Ω–µ –±—ã–ª–æ)

**–¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞:** ‚ùå Amount validation –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 0.0

**–°—Ç–∞—Ç—É—Å –±–æ—Ç–∞:** üî¥ **–ù–ï –û–¢–ö–†–´–í–ê–ï–¢ –ü–û–ó–ò–¶–ò–ò** –∏–∑-–∑–∞ amount=0.0

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ **–í–´–°–û–ö–ò–ô** - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é amount

---

**–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω:** 2025-10-12 18:25
**–ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞:** 16:11 - 18:24 (2—á 13–º–∏–Ω)
**–í–æ–ª–Ω:** 10
**–ü–æ–∑–∏—Ü–∏–π:** 0
**–û—à–∏–±–æ–∫:** 1478 (–≤ –æ—Å–Ω–æ–≤–Ω–æ–º Bybit 10001 –∏–∑-–∑–∞ amount=0.0)
