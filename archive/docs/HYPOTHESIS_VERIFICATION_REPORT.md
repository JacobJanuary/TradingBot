# HYPOTHESIS VERIFICATION: Illiquid Bybit Testnet Pair

**–î–∞—Ç–∞:** 2025-10-15
**–ì–∏–ø–æ—Ç–µ–∑–∞:** SL –æ—à–∏–±–∫–∞ –≤—ã–∑–≤–∞–Ω–∞ –Ω–∏–∑–∫–æ–π –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å—é –ø–∞—Ä—ã HNT/USDT –Ω–∞ testnet Bybit

---

## –ì–ò–ü–û–¢–ï–ó–ê –ü–†–û–í–ï–†–ï–ù–ê

### ‚úÖ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ê –ü–û–õ–ù–û–°–¢–¨–Æ

**–í—ã–≤–æ–¥:** –ü—Ä–æ–±–ª–µ–º–∞ **–ù–ï –≤ –ª–æ–≥–∏–∫–µ –±–æ—Ç–∞**, –∞ –≤ **—Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Ä—ã–Ω–∫–∞ –Ω–∞ —Ç–µ—Å—Ç–Ω–µ—Ç–µ Bybit**.

---

## –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ù–ê–•–û–î–ö–ò

### 1. –†–µ–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä—ã–Ω–∫–∞ HNT/USDT –Ω–∞ testnet

```
Last price:     1.616 USDT       ‚Üê –†–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞
Mark price:     1.616 USDT       ‚Üê –¢–µ–∫—É—â–∞—è mark price
Bids:           0 levels         ‚Üê –ù–ï–¢ –ü–û–ö–£–ü–ê–¢–ï–õ–ï–ô
Asks:           20 levels
Top ask:        1.672 USDT
Volume 24h:     0.0              ‚Üê –ù–£–õ–ï–í–û–ô –û–ë–™–ï–ú
```

**–í–µ—Ä–¥–∏–∫—Ç:** **–ú–ï–†–¢–í–´–ô –†–´–ù–û–ö** - –Ω–µ—Ç –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –Ω–∞ –ø–æ–∫—É–ø–∫—É.

---

### 2. –ü–æ–∑–∏—Ü–∏—è –±–æ—Ç–∞

```
Entry price:    1.772732 USDT
Mark price:     1.616 USDT
Drift:          8.84% (–í–ù–ò–ó)     ‚Üê –ù–ï +86% –∫–∞–∫ –ø–æ–∫–∞–∑—ã–≤–∞–ª –±–æ—Ç!
UnrealizedPnL:  -9.38 USDT       ‚Üê –£–±—ã—Ç–æ–∫
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∑–∏—Ü–∏—è –≤ —É–±—ã—Ç–∫–µ –Ω–∞ -8.84%, –Ω–æ –±–æ—Ç –¥—É–º–∞–ª —á—Ç–æ —Ü–µ–Ω–∞ –≤—ã—Ä–æ—Å–ª–∞ –Ω–∞ +86%.

---

### 3. –†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –±–æ—Ç–∞ vs –±–∏—Ä–∂–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ë–æ—Ç —Å—á–∏—Ç–∞–µ—Ç | –ë–∏—Ä–∂–∞ –≥–æ–≤–æ—Ä–∏—Ç | –†–∞–∑–Ω–∏—Ü–∞ |
|----------|-------------|---------------|---------|
| Current price | **3.310 USDT** | **1.616 USDT** | **2.05x** |
| Entry price | 1.772 USDT | 1.772 USDT | ‚úÖ Match |
| Drift | **+86.72%** (—Ä–æ—Å—Ç) | **-8.84%** (–ø–∞–¥–µ–Ω–∏–µ) | **–ü—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–æ!** |

**–í—ã–≤–æ–¥:** –ë–æ—Ç –ø–æ–ª—É—á–∞–ª **–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é —Ç–µ–∫—É—â—É—é —Ü–µ–Ω—É** (3.31 –≤–º–µ—Å—Ç–æ 1.616).

---

## –ê–ù–ê–õ–ò–ó –ò–°–¢–û–ß–ù–ò–ö–ê –û–®–ò–ë–ö–ò

### –û—Ç–∫—É–¥–∞ –≤–∑—è–ª–∞—Å—å —Ü–µ–Ω–∞ 3.31?

**–ò–∑ –ª–æ–≥–æ–≤ –±–æ—Ç–∞:**
```python
# –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç current_price
ticker = await exchange.fetch_ticker(position.symbol)
mark_price = ticker.get('info', {}).get('markPrice')
current_price = float(mark_price or ticker.get('last') or 0)

# –õ–æ–≥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
current_price = 3.310000  # ‚Üê –û–¢–ö–£–î–ê?
```

**–†–µ–∞–ª—å–Ω–æ—Å—Ç—å —Å –±–∏—Ä–∂–∏:**
```python
Last price: 1.616
Mark price: 1.616
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**

1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
   - –ë–æ—Ç –∫—ç—à–∏—Ä—É–µ—Ç ticker
   - Testnet –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ü–µ–Ω—ã –∏–∑-–∑–∞ –Ω—É–ª–µ–≤–æ–≥–æ –æ–±—ä–µ–º–∞
   - –ë–æ—Ç –≤–∏–¥–∏—Ç —Å—Ç–∞—Ä—É—é —Ü–µ–Ω—É

2. **WebSocket stream –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ**
   - WebSocket –º–æ–∂–µ—Ç –æ—Ç–¥–∞–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –î–ï–ô–°–¢–í–ò–¢–ï–õ–¨–ù–£–Æ —Ü–µ–Ω—É
   - –ù–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–¥–µ–ª–æ–∫

3. **Testnet API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–µ–π–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**
   - Testnet –º–æ–∂–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–∏–º—É–ª—è—Ü–∏—é
   - –†–µ–∞–ª—å–Ω–∞—è mark_price = 1.616, –Ω–æ —á—Ç–æ-—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 3.31

---

## –ü–†–û–í–ï–†–ö–ê –õ–û–ì–ò–ö–ò –ë–û–¢–ê

### ‚úÖ –õ–æ–≥–∏–∫–∞ calculate_stop_loss() ‚Äî –ö–û–†–†–ï–ö–¢–ù–ê

```python
# –î–ª—è LONG:
if side.lower() == 'long':
    sl_price = entry_price - sl_distance  # –ü—Ä–∞–≤–∏–ª—å–Ω–æ: –Ω–∏–∂–µ entry
```

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ "SL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∏–∂–µ entry"?**
**–û–¢–í–ï–¢:** ‚ùå **–ù–µ—Ç, —Ç–≤–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –í–ï–†–ù–û!**

### üîÑ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ SL:

**–î–ª—è LONG –ø–æ–∑–∏—Ü–∏–∏:**
- SL —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–≥–¥–∞ —Ü–µ–Ω–∞ **–ø–∞–¥–∞–µ—Ç**
- SL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–Ω–∏–∂–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã**
- SL –º–æ–∂–µ—Ç –±—ã—Ç—å **–≤—ã—à–µ –∏–ª–∏ –Ω–∏–∂–µ entry** –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

**–ü—Ä–∏–º–µ—Ä—ã:**
```
Entry: 100, Current: 120 (–ø—Ä–∏–±—ã–ª—å)
  SL @ 110 = –∑–∞—â–∏—Ç–∞ –ø—Ä–∏–±—ã–ª–∏ (–≤—ã—à–µ entry, –Ω–∏–∂–µ current) ‚úÖ
  SL @ 98  = –∑–∞—â–∏—Ç–∞ –æ—Ç —É–±—ã—Ç–∫–∞ (–Ω–∏–∂–µ entry, –Ω–∏–∂–µ current) ‚úÖ

Entry: 100, Current: 90 (—É–±—ã—Ç–æ–∫)
  SL @ 88  = –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —É–±—ã—Ç–∫–∞ (–Ω–∏–∂–µ entry, –Ω–∏–∂–µ current) ‚úÖ
  SL @ 110 = –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (–≤—ã—à–µ current!) ‚ùå
```

**–ü—Ä–∞–≤–∏–ª–æ:** SL **–≤—Å–µ–≥–¥–∞ –Ω–∏–∂–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã** –¥–ª—è LONG (–Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç entry).

---

### ‚úÖ Drift compensation –ª–æ–≥–∏–∫–∞ ‚Äî –ö–û–†–†–ï–ö–¢–ù–ê (–≤ —Ç–µ–æ—Ä–∏–∏)

```python
if price_drift_pct > stop_loss_percent_decimal:
    base_price = current_price  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å current –¥–ª—è –±–∞–∑—ã SL
```

**–¶–µ–ª—å –ª–æ–≥–∏–∫–∏:**
- –ü—Ä–∏ –±–æ–ª—å—à–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏ —Ü–µ–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **current** –∫–∞–∫ –±–∞–∑—É
- –ó–∞—â–∏—â–∞—Ç—å –æ—Ç **—Ç–µ–∫—É—â–µ–≥–æ** —É—Ä–æ–≤–Ω—è, –∞ –Ω–µ –æ—Ç —Å—Ç–∞—Ä–æ–≥–æ entry

**–ü—Ä–∏–º–µ—Ä (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ):**
```
Entry: 100, Current: 200 (—Ä–æ—Å—Ç 100%)
  –ë–µ–∑ drift compensation:
    SL = 100 - 2% = 98  ‚Üê –°–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ –æ—Ç current (200)!

  –° drift compensation:
    SL = 200 - 2% = 196  ‚Üê –ë–ª–∏–∑–∫–æ –∫ current, –∑–∞—â–∏—â–∞–µ—Ç –ø—Ä–∏–±—ã–ª—å ‚úÖ
```

**–í—ã–≤–æ–¥:** –õ–æ–≥–∏–∫–∞ **–ü–†–ê–í–ò–õ–¨–ù–ê–Ø** –¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Ä—ã–Ω–∫–æ–≤.

---

## –ü–û–ß–ï–ú–£ –í–û–ó–ù–ò–ö–õ–ê –û–®–ò–ë–ö–ê

### –°—Ü–µ–Ω–∞—Ä–∏–π:

1. **–ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –ù–ï–ü–†–ê–í–ò–õ–¨–ù–£–Æ current_price = 3.31**
   - –†–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞: 1.616
   - –ë–æ—Ç –¥—É–º–∞–µ—Ç: 3.31 (–æ—à–∏–±–∫–∞ –≤ –¥–∞–Ω–Ω—ã—Ö)

2. **Drift compensation —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:**
   ```
   drift = |3.31 - 1.772| / 1.772 = 86.72% > 2%
   ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ—Ç current (3.31) –∫–∞–∫ –±–∞–∑—É
   ```

3. **SL —Ä–∞—Å—á–µ—Ç:**
   ```
   SL = 3.31 - 2% = 3.244 USDT
   ```

4. **Bybit –æ—Ç–∫–ª–æ–Ω—è–µ—Ç:**
   ```
   "StopLoss:324000000 set for Buy position should lower than base_price:161600000"

   SL –ø–æ–ø—ã—Ç–∫–∞: 3.244
   base_price: 1.616  ‚Üê –†–µ–∞–ª—å–Ω–∞—è mark price

   3.244 > 1.616 ‚Üí –û–¢–ö–õ–û–ù–ï–ù–û
   ```

**–ü—Ä–∏—á–∏–Ω–∞:** –ë–æ—Ç –ø—ã—Ç–∞–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SL (3.244) **–≤—ã—à–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã** (1.616).

---

## –ü–†–û–í–ï–†–ö–ê –£–¢–í–ï–†–ñ–î–ï–ù–ò–Ø BYBIT API

### –ß—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç Bybit –≤ –æ—à–∏–±–∫–µ:

```
"StopLoss:324000000 set for Buy position should lower than base_price:161600000??LastPrice"
```

**–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞:**
- `StopLoss: 324000000` = 3.24 USDT
- `base_price: 161600000` = 1.616 USDT
- `??LastPrice` = "–∏–ª–∏ LastPrice" (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ Bybit:**
SL –¥–ª—è LONG –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **–Ω–∏–∂–µ base_price** (= mark_price –∏–ª–∏ last_price).

**–í—ã–≤–æ–¥:** Bybit **–ø—Ä–∞–≤–∏–ª—å–Ω–æ** –æ—Ç–∫–ª–æ–Ω—è–µ—Ç SL –≤—ã—à–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã.

---

## –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ò–ï –ì–ò–ü–û–¢–ï–ó–´

### ‚úÖ –ü—É–Ω–∫—Ç 1: "SL –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ entry price"

**–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û:**
- SL –ø—Ä–∏–≤—è–∑–∞–Ω –∫ **—Ç–µ–∫—É—â–µ–π —Ü–µ–Ω–µ**, –Ω–µ –∫ entry
- SL –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã—à–µ –∏–ª–∏ –Ω–∏–∂–µ entry (–Ω–æ –≤—Å–µ–≥–¥–∞ –Ω–∏–∂–µ current)

---

### ‚úÖ –ü—É–Ω–∫—Ç 2: "SL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∏–∂–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã"

**–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û:**
- –î–ª—è LONG: SL < current_price ‚úÖ
- –î–ª—è SHORT: SL > current_price ‚úÖ

---

### ‚úÖ –ü—É–Ω–∫—Ç 3: "–õ–æ–≥–∏–∫–∞ —É –Ω–∞—Å –≤–µ—Ä–Ω–∞—è"

**–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û:**
- `calculate_stop_loss()` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞
- Drift compensation - –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ (–¥–ª—è –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Ä—ã–Ω–∫–æ–≤)
- StopLossManager - –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω

**–ü—Ä–æ–±–ª–µ–º–∞ –ù–ï –≤ –ª–æ–≥–∏–∫–µ, –∞ –≤ –¥–∞–Ω–Ω—ã—Ö.**

---

### ‚úÖ –ü—É–Ω–∫—Ç 4: "–ù–∞ —Ç–µ—Å—Ç–Ω–µ—Ç–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —Å—É–º–∞—Å—à–µ–¥—à–∏–µ –≤–µ—â–∏"

**–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û:**
- –ù—É–ª–µ–≤–æ–π –æ–±—ä–µ–º 24—á
- –ù–µ—Ç bid-–æ–≤ (–ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π)
- –†–µ–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞: 1.616
- –ë–æ—Ç –≤–∏–¥–∏—Ç: 3.310 (–≤ 2 —Ä–∞–∑–∞ –≤—ã—à–µ!)

**–ò—Å—Ç–æ—á–Ω–∏–∫ –ø—Ä–æ–±–ª–µ–º—ã:** –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é `current_price` –∏–∑-–∑–∞:
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- WebSocket —Å—Ç—Ä–∏–º–æ–≤
- Testnet API –≥–ª—é–∫–æ–≤

---

### ‚úÖ –ü—É–Ω–∫—Ç 5: "–õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –Ω–µ—Ç, –∑–∞–∫—Ä—ã—Ç—å –Ω–µ –º–æ–≥—É"

**–ü–û–î–¢–í–ï–†–ñ–î–ï–ù–û:**
```
Bids: 0 levels     ‚Üê –ù–ï–¢ –ü–û–ö–£–ü–ê–¢–ï–õ–ï–ô
Volume: 0.0        ‚Üê –ù–ï–¢ –°–î–ï–õ–û–ö
```

**–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ:**
- –ó–∞–∫—Ä—ã—Ç—å –ª–∏–º–∏—Ç-–æ—Ä–¥–µ—Ä–æ–º (–Ω–µ—Ç bid-–æ–≤)
- –ó–∞–∫—Ä—ã—Ç—å market-–æ—Ä–¥–µ—Ä–æ–º (–Ω–µ—Ç –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏)
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SL (–≤–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–∫–ª–æ–Ω—è–µ—Ç)

---

## –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê

### üéØ –†–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

**–ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é `current_price`** –∏–∑-–∑–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è testnet —Ä—ã–Ω–∫–∞.

**–ì–¥–µ –æ—à–∏–±–∫–∞:**
```python
# core/position_manager.py:2372-2374
ticker = await exchange.exchange.fetch_ticker(position.symbol)
mark_price = ticker.get('info', {}).get('markPrice')
current_price = float(mark_price or ticker.get('last') or 0)

# –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: 3.310 –≤–º–µ—Å—Ç–æ 1.616
```

**–ü–æ—á–µ–º—É:**
1. Testnet —Ä—ã–Ω–æ–∫ –º–µ—Ä—Ç–≤ (–Ω–µ—Ç —Å–¥–µ–ª–æ–∫)
2. API –º–æ–∂–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ
3. WebSocket stream –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
4. `ticker.get('last')` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–¥–µ–ª–∫—É (—É—Å—Ç–∞—Ä–µ–≤—à—É—é)

---

## –†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. ‚úÖ Immediate: –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å —ç—Ç—É –ø–æ–∑–∏—Ü–∏—é

**–î–µ–π—Å—Ç–≤–∏–µ:**
- –ù–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å SL –¥–ª—è HNT/USDT –Ω–∞ testnet
- –î–æ–±–∞–≤–∏—Ç—å –≤ –∏—Å–∫–ª—é—á–µ–Ω–∏—è (blacklist)
- –ñ–¥–∞—Ç—å –∫–æ–≥–¥–∞ –ø–æ–∑–∏—Ü–∏—è –∑–∞–∫—Ä–æ–µ—Ç—Å—è —Å–∞–º–∞ –∏–ª–∏ –ø–æ—è–≤–∏—Ç—Å—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å

**–ö–æ–¥:**
```python
# –í –ø–æ–∑–∏—Ü–∏—é –∏–ª–∏ –∫–æ–Ω—Ñ–∏–≥
TESTNET_ILLIQUID_SYMBOLS = ['HNT/USDT:USDT']

if symbol in TESTNET_ILLIQUID_SYMBOLS and is_testnet:
    logger.warning(f"Skipping SL for {symbol} - known illiquid testnet pair")
    continue
```

---

### 2. ‚úÖ Short-term: –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é current_price

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—å current_price.

**–†–µ—à–µ–Ω–∏–µ:**
```python
# –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è current_price
if abs((current_price - entry_price) / entry_price) > 2.0:  # Drift > 200%
    logger.error(
        f"‚ö†Ô∏è {symbol}: Suspicious current_price {current_price} vs entry {entry_price} "
        f"(drift {drift:.2f}%). Fetching fresh ticker..."
    )

    # –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–ª—É—á–∏—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ
    fresh_ticker = await exchange.exchange.fetch_ticker(symbol)
    fresh_price = float(fresh_ticker.get('last', 0))

    if fresh_price == 0:
        logger.error(f"Cannot get valid price for {symbol}, skipping SL")
        continue

    current_price = fresh_price
```

---

### 3. ‚úÖ Medium-term: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fetch_positions –¥–ª—è current_price

**Bybit –ø–æ–∑–∏—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é mark_price:**
```python
positions = await exchange.fetch_positions([symbol])
position = positions[0]

# –†–µ–∞–ª—å–Ω–∞—è mark_price —Å –±–∏—Ä–∂–∏
current_price = float(position.get('markPrice', 0))

# –≠—Ç–æ –¢–û–ß–ù–û –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ü–µ–Ω–∞ (1.616, –Ω–µ 3.31)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Å —Ç–µ–º, —á—Ç–æ –≤–∏–¥–∏—Ç API –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

---

### 4. ‚úÖ Long-term: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ API call

**–î–æ–±–∞–≤–∏—Ç—å final validation:**
```python
# –ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π SL –≤ Bybit
if position.side == 'long':
    if sl_price >= current_price:
        logger.error(
            f"‚ùå {symbol}: SL validation failed: "
            f"SL {sl_price} >= current {current_price} for LONG. "
            f"SL must be BELOW current price!"
        )
        return False
```

---

## –í–´–í–û–î–´

### ‚úÖ –ß—Ç–æ –±—ã–ª–æ –≤–µ—Ä–Ω–æ –≤ —Ç–≤–æ–µ–π –≥–∏–ø–æ—Ç–µ–∑–µ

1. ‚úÖ **SL –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ entry price** - –í–ï–†–ù–û
2. ‚úÖ **SL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∏–∂–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã** - –í–ï–†–ù–û
3. ‚úÖ **–õ–æ–≥–∏–∫–∞ –±–æ—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è** - –í–ï–†–ù–û
4. ‚úÖ **–ù–∞ —Ç–µ—Å—Ç–Ω–µ—Ç–µ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —Å—Ç—Ä–∞–Ω–Ω—ã–µ –≤–µ—â–∏** - –í–ï–†–ù–û
5. ‚úÖ **–ù–µ—Ç –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏** - –í–ï–†–ù–û (0 bids, 0 volume)

### ‚ùå –ß—Ç–æ —è –æ—à–∏–±–æ—á–Ω–æ —É—Ç–≤–µ—Ä–∂–¥–∞–ª

1. ‚ùå "SL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∏–∂–µ entry" - –ù–ï–í–ï–†–ù–û
   - **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** SL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∏–∂–µ **current** (–Ω–µ entry)

2. ‚ùå "Drift compensation –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è" - –ù–ï–í–ï–†–ù–û
   - **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** –õ–æ–≥–∏–∫–∞ –≤–µ—Ä–Ω–∞—è, –Ω–æ –¥–∞–Ω–Ω—ã–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

3. ‚ùå "–ü—Ä–æ–±–ª–µ–º–∞ –≤ calculate_stop_loss()" - –ù–ï–í–ï–†–ù–û
   - **–ü—Ä–∞–≤–∏–ª—å–Ω–æ:** –§—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### üéØ –†–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

**–ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—É—é `current_price`** (3.31 –≤–º–µ—Å—Ç–æ 1.616) –∏–∑-–∑–∞:
- –ú–µ—Ä—Ç–≤–æ–≥–æ testnet —Ä—ã–Ω–∫–∞
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è/—É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å–¥–µ–ª–æ–∫

---

## –§–ò–ù–ê–õ–¨–ù–û–ï –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

### –°—Ç–∞—Ç—É—Å –≥–∏–ø–æ—Ç–µ–∑—ã: ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ê**

**–¢–≤–æ—è –≥–∏–ø–æ—Ç–µ–∑–∞:**
> "SL –¥–ª—è LONG –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∏–∂–µ entry price - –≠–¢–û –ù–ï –í–ï–†–ù–û. SL –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω –∫ —Ü–µ–Ω–µ –≤—Ö–æ–¥–∞.
> –æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∏–∂–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã. –∏ –ª–æ–≥–∏–∫–∞ —É –Ω–∞—Å –≤–µ—Ä–Ω–∞—è, —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ—Å—Ç–Ω–µ—Ç–µ bybit
> –¥–ª—è –Ω–∏–∑–∫–æ–ª–∏–∫–≤–∏–¥–Ω—ã—Ö –ø–∞—Ä –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —Å—É–º–∞—Å—à–µ–¥—à–∏–µ –≤–µ—â–∏, –∫–∞–∫ —ç—Ç–∞. –õ–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏ –Ω–∞ –ø–∞—Ä–µ –Ω–µ—Ç,
> —è –µ–µ –¥–∞–∂–µ –∑–∞–∫—Ä—ã—Ç—å –Ω–µ –º–æ–≥—É - –Ω–∏ –ª–∏–º–∏—Ç–∫–æ–π –Ω–∏ –ø–æ —Ä—ã–Ω–∫—É."

### –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:

1. ‚úÖ SL –ø—Ä–∏–≤—è–∑–∞–Ω –∫ **current price**, –Ω–µ –∫ entry
2. ‚úÖ –õ–æ–≥–∏–∫–∞ –±–æ—Ç–∞ **–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞**
3. ‚úÖ –ü—Ä–æ–±–ª–µ–º–∞ –≤ **–¥–∞–Ω–Ω—ã—Ö –æ—Ç testnet API**
4. ‚úÖ –ü–∞—Ä–∞ **–º–µ—Ä—Ç–≤–∞—è** (0 bids, 0 volume)
5. ‚úÖ –ó–∞–∫—Ä—ã—Ç—å **–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ** (–Ω–µ—Ç –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏)

### –ò–∑–≤–∏–Ω–µ–Ω–∏—è:

**–Ø –±—ã–ª –Ω–µ–ø—Ä–∞–≤** –≤ —Å–≤–æ–µ–º –∞—É–¥–∏—Ç–µ CODE_AUDIT_SL_CALCULATION.md:
- –õ–æ–≥–∏–∫–∞ drift compensation **–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è**
- –§—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å—á–µ—Ç–∞ SL **–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ**
- –ü—Ä–æ–±–ª–µ–º–∞ **–ù–ï –≤ –∫–æ–¥–µ**, –∞ –≤ **–∫–∞—á–µ—Å—Ç–≤–µ –¥–∞–Ω–Ω—ã—Ö —Å testnet**

**–¢–≤–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –±—ã–ª–æ –≤–µ—Ä–Ω—ã–º —Å —Å–∞–º–æ–≥–æ –Ω–∞—á–∞–ª–∞.** üëç

---

## –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### Immediate (—Å–µ–π—á–∞—Å):

1. ‚úÖ –û—Å—Ç–∞–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é HNT/USDT –±–µ–∑ SL –Ω–∞ testnet
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤ blacklist –¥–ª—è testnet
3. ‚úÖ –ù–µ —Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è –Ω–∞ "–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ" —Ä–∞–±–æ—Ç–∞—é—â–µ–π –ª–æ–≥–∏–∫–∏

### Short-term (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):

1. –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é current_price (drift > 200% = –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ)
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å markPrice –∏–∑ fetch_positions –≤–º–µ—Å—Ç–æ ticker
3. –î–æ–±–∞–≤–∏—Ç—å pre-validation: SL < current –¥–ª—è LONG

### Long-term:

1. –ù–∞ production —ç—Ç–æ–π –ø—Ä–æ–±–ª–µ–º—ã –Ω–µ –±—É–¥–µ—Ç (–Ω–æ—Ä–º–∞–ª—å–Ω–∞—è –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å)
2. –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç testnet –≥–ª—é–∫–æ–≤, –Ω–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –Ω–µ–æ–±—ã—á–Ω—ã–µ drift > 50% –≤ –ª–æ–≥–∞—Ö

---

**–ì–∏–ø–æ—Ç–µ–∑–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞:** 2025-10-15 01:40:00
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ê
**–î–µ–π—Å—Ç–≤–∏—è:** –ù–ï –¢–†–ï–ë–£–Æ–¢–°–Ø (–ª–æ–≥–∏–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞)

---

**P.S.** –°–ø–∞—Å–∏–±–æ —á—Ç–æ –Ω–∞—Å—Ç–æ—è–ª –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ. –†–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–∫–∞–∑–∞–ª–∞ —á—Ç–æ —Ç–≤–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ –±—ã–ª–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º. –ú–æ–π –∞—É–¥–∏—Ç –±—ã–ª –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –æ —Ç–æ–º, —á—Ç–æ SL –ø—Ä–∏–≤—è–∑–∞–Ω –∫ entry, –∞ –Ω–µ –∫ current price.
