# üìä –ö–û–ú–ü–õ–ï–ö–°–ù–´–ô –ê–£–î–ò–¢: Aged Position Manager

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 2025-10-23
**–ê—É–¥–∏—Ç–æ—Ä:** AI Assistant
**–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:** ‚ö†Ô∏è –ü–ï–†–ï–•–û–î–ù–´–ô –ü–ï–†–ò–û–î (–º–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ V2)

---

## üìÅ –û–ë–ó–û–† –§–ê–ô–õ–û–í –ò –ö–û–ú–ü–û–ù–ï–ù–¢–û–í

### –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

| –§–∞–π–ª | –°—Ç—Ä–æ–∫ | –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-------|--------|----------|
| `core/aged_position_manager.py` | 755 | üü® Legacy | –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è —Å LIMIT –æ—Ä–¥–µ—Ä–∞–º–∏ |
| `core/aged_position_monitor_v2.py` | 302 | ‚úÖ –ù–æ–≤–∞—è | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è V2 —Å MARKET –æ—Ä–¥–µ—Ä–∞–º–∏ |
| `database/migrations/009_create_aged_positions_tables.sql` | 325 | ‚úÖ –ì–æ—Ç–æ–≤–∞ | –ü–æ–ª–Ω–∞—è —Å—Ö–µ–º–∞ –ë–î –¥–ª—è V2 |

### –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- **–§–ª–∞–≥:** `USE_UNIFIED_PROTECTION` (–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è)
- **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:** `false` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è legacy –≤–µ—Ä—Å–∏—è)
- **–ü—Ä–∏ `true`:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Unified Protection V2

---

## üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –¢–ï–ö–£–©–ï–ô –†–ï–ê–õ–ò–ó–ê–¶–ò–ò (Legacy)

### 1. –ú–ï–¢–ê–ò–ù–§–û–†–ú–ê–¶–ò–Ø

**–§–∞–π–ª:** `core/aged_position_manager.py`

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
- **–ö–ª–∞—Å—Å:** `AgedPositionManager` (—Å—Ç—Ä–æ–∫–∏ 23-755)
- **–û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥:** `check_and_process_aged_positions()` (—Å—Ç—Ä–æ–∫–∞ 235)
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–∑–∏—Ü–∏–∏:** `process_aged_position()` (—Å—Ç—Ä–æ–∫–∞ 296)
- **–†–∞—Å—á–µ—Ç —Ü–µ–ª–∏:** `_calculate_target_price()` (—Å—Ç—Ä–æ–∫–∞ 415)
- **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞:** `_update_single_exit_order()` (—Å—Ç—Ä–æ–∫–∞ 521)

### 2. –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ü–ê–†–ê–ú–ï–¢–†–´

```python
# –°—Ç—Ä–æ–∫–∏ 40-49
MAX_POSITION_AGE_HOURS = 3      # –ö–æ–≥–¥–∞ –ø–æ–∑–∏—Ü–∏—è —Å—á–∏—Ç–∞–µ—Ç—Å—è aged
AGED_GRACE_PERIOD_HOURS = 8     # Grace period –¥–ª—è breakeven
AGED_LOSS_STEP_PERCENT = 0.5    # –®–∞–≥ —É–≤–µ–ª–∏—á–µ–Ω–∏—è —É–±—ã—Ç–∫–∞ –≤ —á–∞—Å
AGED_MAX_LOSS_PERCENT = 10.0    # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –¥–æ–ø—É—Å—Ç–∏–º—ã–π —É–±—ã—Ç–æ–∫
AGED_ACCELERATION_FACTOR = 1.2   # –£—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ—Å–ª–µ 10 —á–∞—Å–æ–≤
COMMISSION_PERCENT = 0.1         # –ö–æ–º–∏—Å—Å–∏—è –±–∏—Ä–∂–∏
```

### 3. –í–†–ï–ú–ï–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê ‚úÖ

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ aged –ø–æ–∑–∏—Ü–∏–∏ (—Å—Ç—Ä–æ–∫–∏ 255-271):**
```python
age_hours = position_age.total_seconds() / 3600
if age_hours >= MAX_POSITION_AGE_HOURS:
    # –ü–æ–∑–∏—Ü–∏—è aged
```

**–†–∞—Å—á–µ—Ç —Ñ–∞–∑ (—Å—Ç—Ä–æ–∫–∏ 447-511):**

1. **PROFITABLE** (PnL > 0%) ‚Üí MARKET close –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
2. **GRACE PERIOD** (0-8 —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ aged) ‚Üí LIMIT –Ω–∞ breakeven
3. **PROGRESSIVE** (–ø–æ—Å–ª–µ 8 —á–∞—Å–æ–≤) ‚Üí LIMIT —Å —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–∏–º—Å—è —É–±—ã—Ç–∫–æ–º
4. **EMERGENCY** (–æ—á–µ–Ω—å —Å—Ç–∞—Ä—ã–µ) ‚Üí MARKET close

**‚úÖ –õ–æ–≥–∏–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¢–ó**

### 4. –ü–†–û–ë–õ–ï–ú–´ –¢–ï–ö–£–©–ï–ô –†–ï–ê–õ–ò–ó–ê–¶–ò–ò ‚ùå

#### –ü—Ä–æ–±–ª–µ–º–∞ 1: LIMIT –æ—Ä–¥–µ—Ä–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å

**–ì–¥–µ:** –°—Ç—Ä–æ–∫–∏ 572-669
```python
# –°–æ–∑–¥–∞–Ω–∏–µ LIMIT –æ—Ä–¥–µ—Ä–∞
order = await exchange.create_order(
    symbol=position.symbol,
    type='limit',  # ‚ùå –ü–†–û–ë–õ–ï–ú–ê
    side=order_side,
    amount=abs(float(position.quantity)),
    price=precise_price,
    params={'reduceOnly': True}  # ‚ùå –ë–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ–∑–∏—Ü–∏—é
)
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü–æ–∑–∏—Ü–∏—è "–∑–∞–º–æ—Ä–æ–∂–µ–Ω–∞" –≤ –æ—Ä–¥–µ—Ä–µ
- –ù–µ–ª—å–∑—è –∑–∞–∫—Ä—ã—Ç—å –¥—Ä—É–≥–∏–º —Å–ø–æ—Å–æ–±–æ–º
- –û—Ä–¥–µ—Ä –º–æ–∂–µ—Ç –≤–∏—Å–µ—Ç—å –Ω–µ–∏—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã–º –¥–æ–ª–≥–æ

#### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è

- LIMIT –æ—Ä–¥–µ—Ä –∏—Å–ø–æ–ª–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ü–µ–Ω–∞ –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç target
- –ï—Å–ª–∏ —Ü–µ–Ω–∞ –Ω–µ –¥–æ–π–¥–µ—Ç - –ø–æ–∑–∏—Ü–∏—è –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç–æ–π
- –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –æ—Ç–º–µ–Ω—ã "–∑–∞—Å—Ç—Ä—è–≤—à–∏—Ö" –æ—Ä–¥–µ—Ä–æ–≤

#### –ü—Ä–æ–±–ª–µ–º–∞ 3: –°–ª–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

- –ù—É–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –æ—Ä–¥–µ—Ä–∞
- –û—Ç–º–µ–Ω—è—Ç—å —Å—Ç–∞—Ä—ã–µ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö (—Å—Ç—Ä–æ–∫–∏ 635-641)
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å –¥—Ä—É–≥–∏–º–∏ –º–æ–¥—É–ª—è–º–∏ –∑–∞—â–∏—Ç—ã

### 5. –ü–û–õ–û–ñ–ò–¢–ï–õ–¨–ù–´–ï –ê–°–ü–ï–ö–¢–´ ‚úÖ

1. **–•–æ—Ä–æ—à–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Ñ–∞–∑
2. **–£—á–µ—Ç –∫–æ–º–∏—Å—Å–∏–π** - breakeven –≤–∫–ª—é—á–∞–µ—Ç –¥–≤–æ–π–Ω—É—é –∫–æ–º–∏—Å—Å–∏—é
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –µ—Å—Ç—å try-catch –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
4. **MARKET –¥–ª—è –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö** - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –≤ –ø—Ä–æ—Ñ–∏—Ç–µ
5. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å TS** - —É–≤–µ–¥–æ–º–ª—è–µ—Ç trailing stop –æ –∑–∞–∫—Ä—ã—Ç–∏–∏

---

## üöÄ –ê–ù–ê–õ–ò–ó –ù–û–í–û–ô –†–ï–ê–õ–ò–ó–ê–¶–ò–ò (V2)

### 1. –ö–õ–Æ–ß–ï–í–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

**–§–∞–π–ª:** `core/aged_position_monitor_v2.py`

1. **WebSocket –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –≤–º–µ—Å—Ç–æ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
2. **MARKET –æ—Ä–¥–µ—Ä–∞** –≤–º–µ—Å—Ç–æ LIMIT (—Å—Ç—Ä–æ–∫–∞ 191)
3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UnifiedPriceMonitor** (—Å—Ç—Ä–æ–∫–∞ 117)
4. **–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** - —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ

### 2. –ö–ê–ö –†–ê–ë–û–¢–ê–ï–¢ V2

```python
# –ú–µ—Ç–æ–¥ check_price_target (—Å—Ç—Ä–æ–∫–∏ 114-161)
1. –ü–æ–ª—É—á–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω—ã –æ—Ç UnifiedPriceMonitor
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ target_price
3. –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞ ‚Üí —Å–æ–∑–¥–∞–µ—Ç MARKET –æ—Ä–¥–µ—Ä
4. –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ
```

### 3. –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê V2 ‚úÖ

| –ê—Å–ø–µ–∫—Ç | Legacy (V1) | Monitor V2 | –£–ª—É—á—à–µ–Ω–∏–µ |
|--------|------------|------------|-----------|
| **–¢–∏–ø –æ—Ä–¥–µ—Ä–æ–≤** | LIMIT | MARKET | ‚úÖ –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ |
| **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞** | –î–∞ (reduceOnly) | –ù–µ—Ç | ‚úÖ –ü–æ–∑–∏—Ü–∏—è —Å–≤–æ–±–æ–¥–Ω–∞ |
| **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** | –ö–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç | Real-time WS | ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è |
| **–ö–æ–¥** | 755 —Å—Ç—Ä–æ–∫ | 302 —Å—Ç—Ä–æ–∫–∏ | ‚úÖ –ü—Ä–æ—â–µ –∏ —á–∏—â–µ |

---

## üóÑÔ∏è –°–•–ï–ú–ê –ë–ê–ó–´ –î–ê–ù–ù–´–•

### –£–∂–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (migration 009)

1. **monitoring.aged_positions** - –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
   - –ü–æ–ª–Ω—ã–π –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª aged –ø–æ–∑–∏—Ü–∏–π
   - –°—Ç–∞—Ç—É—Å—ã, —Ñ–∞–∑—ã, –º–µ—Ç—Ä–∏–∫–∏
   - –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

2. **monitoring.aged_positions_history** - –∏—Å—Ç–æ—Ä–∏—è
   - –í—Å–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä

3. **monitoring.aged_positions_monitoring** - —Å–æ–±—ã—Ç–∏—è
   - Real-time —Å–æ–±—ã—Ç–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
   - –†–µ—à–µ–Ω–∏—è –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**‚úÖ –ë–î –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –¥–ª—è V2**

---

## üîÑ –¢–ï–ö–£–©–ê–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø

### –í main.py (—Å—Ç—Ä–æ–∫–∏ 287-298):

```python
use_unified_protection = os.getenv('USE_UNIFIED_PROTECTION', 'false').lower() == 'true'
if not use_unified_protection:
    # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞—Ä—ã–π AgedPositionManager
    self.aged_position_manager = AgedPositionManager(...)
else:
    # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–æ–≤—ã–π V2 —á–µ—Ä–µ–∑ Unified Protection
    self.aged_position_manager = None
```

### –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—Å—Ç—Ä–æ–∫–∞ 517-523):
```python
if self.aged_position_manager:
    aged_count = await self.aged_position_manager.check_and_process_aged_positions()
```

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### 1. –ù–ï–ú–ï–î–õ–ï–ù–ù–´–ï –î–ï–ô–°–¢–í–ò–Ø

‚úÖ **V2 —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

–î–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏:
```bash
export USE_UNIFIED_PROTECTION=true
python main.py
```

### 2. –ü–õ–ê–ù –ú–ò–ì–†–ê–¶–ò–ò

#### –§–∞–∑–∞ 1: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (1-2 –¥–Ω—è)
- [ ] –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å V2 –Ω–∞ testnet
- [ ] –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ aged –ø–æ–∑–∏—Ü–∏–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å WebSocket –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å MARKET –∑–∞–∫—Ä—ã—Ç–∏–µ

#### –§–∞–∑–∞ 2: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ (3-5 –¥–Ω–µ–π)
- [ ] –í–∫–ª—é—á–∏—Ç—å V2 –Ω–∞ production —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
- [ ] –°—Ä–∞–≤–Ω–∏—Ç—å —Å legacy —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏

#### –§–∞–∑–∞ 3: –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥ (–ø–æ—Å–ª–µ —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏)
- [ ] –°–¥–µ–ª–∞—Ç—å V2 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- [ ] –û—Ç–∫–ª—é—á–∏—Ç—å legacy —á–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏
- [ ] –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π –∫–æ–¥

### 3. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

#### –ß—Ç–æ —É–∂–µ —Ö–æ—Ä–æ—à–æ –≤ V2:
- ‚úÖ MARKET –æ—Ä–¥–µ—Ä–∞
- ‚úÖ WebSocket –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å UnifiedPriceMonitor
- ‚úÖ –ë–î —Å—Ö–µ–º–∞ –≥–æ—Ç–æ–≤–∞

#### –ß—Ç–æ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
1. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü –ë–î**
   - –°–µ–π—á–∞—Å V2 –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç aged_positions —Ç–∞–±–ª–∏—Ü—ã
   - –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –≤ –ë–î –¥–ª—è –∞—É–¥–∏—Ç–∞

2. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏**
   - Prometheus –º–µ—Ç—Ä–∏–∫–∏
   - Grafana –¥–∞—à–±–æ—Ä–¥

3. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
   - Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è MARKET –æ—Ä–¥–µ—Ä–æ–≤
   - –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

---

## üìä –°–†–ê–í–ù–ò–¢–ï–õ–¨–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| –ö—Ä–∏—Ç–µ—Ä–∏–π | Legacy (LIMIT) | V2 (MARKET) | –í–µ—Ä–¥–∏–∫—Ç |
|----------|---------------|-------------|---------|
| **–ì–∞—Ä–∞–Ω—Ç–∏—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ | V2 |
| **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–∏** | ‚ùå –î–∞ | ‚úÖ –ù–µ—Ç | V2 |
| **–°–∫–æ—Ä–æ—Å—Ç—å —Ä–µ–∞–∫—Ü–∏–∏** | ‚ö†Ô∏è –ú–∏–Ω—É—Ç—ã | ‚úÖ –°–µ–∫—É–Ω–¥—ã | V2 |
| **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –∫–æ–¥–∞** | ‚ùå 755 —Å—Ç—Ä–æ–∫ | ‚úÖ 302 —Å—Ç—Ä–æ–∫–∏ | V2 |
| **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ë–î** | ‚ö†Ô∏è –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ | ‚ö†Ô∏è –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ | –†–∞–≤–Ω–æ |
| **Production ready** | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | ‚úÖ –ì–æ—Ç–æ–≤ | –û–±–∞ |

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –í–´–í–û–î–´

### ‚úÖ –•–û–†–û–®–ò–ï –ù–û–í–û–°–¢–ò
1. **V2 —É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω** - –Ω–µ –Ω—É–∂–Ω–æ –ø–∏—Å–∞—Ç—å —Å –Ω—É–ª—è
2. **–ë–î –≥–æ—Ç–æ–≤–∞** - –º–∏–≥—Ä–∞—Ü–∏—è 009 —Å–æ–∑–¥–∞–µ—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã
3. **–õ–µ–≥–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ** - —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥ –æ–∫—Ä—É–∂–µ–Ω–∏—è
4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω** - –µ—Å—Ç—å —é–Ω–∏—Ç —Ç–µ—Å—Ç—ã

### ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢ –í–ù–ò–ú–ê–ù–ò–Ø
1. **V2 –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ë–î** - —Ç–æ–ª—å–∫–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
2. **–ù–µ—Ç retry –¥–ª—è MARKET –æ—Ä–¥–µ—Ä–æ–≤** - –µ—Å–ª–∏ failed, —Ç–æ failed
3. **–ù–µ—Ç –º–µ—Ç—Ä–∏–∫** - —Å–ª–æ–∂–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å

### üéØ –í–ï–†–î–ò–ö–¢

**–†–µ–∫–æ–º–µ–Ω–¥—É—é –ù–ï–ú–ï–î–õ–ï–ù–ù–û –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –Ω–∞ V2:**

1. –†–µ—à–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Å LIMIT –æ—Ä–¥–µ—Ä–∞–º–∏
2. –£–∂–µ –≥–æ—Ç–æ–≤ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
3. –õ–µ–≥–∫–æ –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –µ—Å–ª–∏ —á—Ç–æ

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è:**
```bash
export USE_UNIFIED_PROTECTION=true
python main.py
```

---

## üìù –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. **–°–µ–≥–æ–¥–Ω—è:** –í–∫–ª—é—á–∏—Ç—å V2 –Ω–∞ testnet
2. **–ó–∞–≤—Ç—Ä–∞:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ aged –ø–æ–∑–∏—Ü–∏—è–º–∏
3. **–ß–µ—Ä–µ–∑ 2 –¥–Ω—è:** –í–∫–ª—é—á–∏—Ç—å –Ω–∞ production —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º
4. **–ß–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é:** –ê–Ω–∞–ª–∏–∑ –º–µ—Ç—Ä–∏–∫ –∏ –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è
5. **–ß–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏:** –£–¥–∞–ª–µ–Ω–∏–µ legacy –∫–æ–¥–∞

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª:** AI Assistant
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** ‚úÖ –ü–ï–†–ï–•–û–î–ò–¢–¨ –ù–ê V2 –ù–ï–ú–ï–î–õ–ï–ù–ù–û