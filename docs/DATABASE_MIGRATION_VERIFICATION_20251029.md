# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ú–∏–≥—Ä–∞—Ü–∏–π –ë–∞–∑—ã –î–∞–Ω–Ω—ã—Ö

**–î–∞—Ç–∞**: 2025-10-29
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ó–ê–í–ï–†–®–ï–ù–û

---

## üìã –ó–∞–¥–∞—á–∞

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ä–µ–∞–ª—å–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ –≤—Å–µ–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏, —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏ –∏ —Å—Ö–µ–º–∞–º–∏, –∏ –æ–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ `database/migrations/001_init_schema.sql`, —á—Ç–æ–±—ã –ø—Ä–∏ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–∏ –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –º–æ–∂–Ω–æ –±—ã–ª–æ —Å–æ–∑–¥–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.

---

## üîç –≠—Ç–∞–ø—ã –†–∞–±–æ—Ç—ã

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ü—Ä–æ–¥–∞–∫—à–Ω –ë–î

```bash
Database: fox_crypto
User: evgeniyyanvarskiy
PostgreSQL Version: 15.13 (Homebrew) on aarch64-apple-darwin24.4.0
```

### 2. –ê–Ω–∞–ª–∏–∑ –°—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î

**–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Å—Ö–µ–º—ã:**
- `fas` - –°—Ö–µ–º–∞ –¥–ª—è FAS scoring service ‚ö†Ô∏è **–ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –±–æ—Ç–∞
- `monitoring` - –û—Å–Ω–æ–≤–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –±–æ—Ç–∞
- `public` - PostgreSQL default schema –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–π

**–¢–∞–±–ª–∏—Ü—ã (14 total –≤ –º–∏–≥—Ä–∞—Ü–∏–∏):**

**Schema `fas`:** ‚ùå **–£–î–ê–õ–ï–ù–ê** - –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –±–æ—Ç–µ

**Schema `monitoring` (14 tables):**
1. `positions` - Active and historical positions
2. `orders` - Order execution history
3. `trades` - Completed trades
4. `trailing_stop_state` - Trailing stop management
5. `orders_cache` - Orders cache for fast access
6. `aged_positions` - Aged positions tracking
7. `aged_monitoring_events` - Aged position events
8. `risk_events` - Risk management events
9. `risk_violations` - Risk limit violations
10. `events` - Main event log (69 event types)
11. `event_performance_metrics` - Performance metrics
12. `transaction_log` - Audit transaction log
13. `performance_metrics` - Performance tracking
14. `params` - Backtest filter parameters per exchange

**–§—É–Ω–∫—Ü–∏–∏ (2):**
1. `normalize_trailing_stop_side()` - Auto-lowercase side column
2. `update_updated_at_column()` - Auto-update timestamps

**–¢—Ä–∏–≥–≥–µ—Ä—ã (4):**
1. `normalize_side_trigger` - On trailing_stop_state (BEFORE INSERT/UPDATE)
2. `update_params_updated_at` - On params (BEFORE UPDATE)
3. `update_positions_updated_at` - On positions (BEFORE UPDATE)
4. `update_trades_updated_at` - On trades (BEFORE UPDATE)

**–ò–Ω–¥–µ–∫—Å—ã:** 35+ indexes –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

**Foreign Keys:**
- `trailing_stop_state.position_id` ‚Üí `positions.id` (ON DELETE CASCADE)

### 3. –≠–∫—Å–ø–æ—Ä—Ç –¢–µ–∫—É—â–µ–π –°—Ö–µ–º—ã

```bash
pg_dump -h localhost -U evgeniyyanvarskiy -d fox_crypto \
  --schema-only --no-owner --no-privileges > /tmp/current_db_schema.sql
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 1455 —Å—Ç—Ä–æ–∫

### 4. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–æ –°—Ç–∞—Ä–æ–π –ú–∏–≥—Ä–∞—Ü–∏–µ–π

**–°—Ç–∞—Ä–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** (`001_init_schema.sql`):
- –†–∞–∑–º–µ—Ä: 1306 —Å—Ç—Ä–æ–∫, ~35KB
- **–û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ:**
  - –¢–∞–±–ª–∏—Ü–∞ `monitoring.params`

**–ù–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (–ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è fas):**
- –†–∞–∑–º–µ—Ä: 1403 —Å—Ç—Ä–æ–∫–∏, 40KB
- –í–∫–ª—é—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ò–°–ü–û–õ–¨–ó–£–ï–ú–´–ï —Ç–∞–±–ª–∏—Ü—ã
- ‚ùå –£–¥–∞–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ `fas` –∏ —Ç–∞–±–ª–∏—Ü–∞ `fas.scoring_history` (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –±–æ—Ç–µ)

### 5. –°–æ–∑–¥–∞–Ω–∏–µ –û–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π –ú–∏–≥—Ä–∞—Ü–∏–∏

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `monitoring.params`
2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –¥–∞—Ç–æ–π (2025-10-29)
3. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ `CREATE SCHEMA IF NOT EXISTS`
4. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ `CREATE OR REPLACE FUNCTION`
5. ‚úÖ –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–æ–±–ª–µ–º–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ `SET transaction_timeout = 0;` (–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–æ –≤—Å–µ—Ö —Å–±–æ—Ä–∫–∞—Ö PostgreSQL 15)
6. ‚ùå **–£–î–ê–õ–ï–ù–ê** —Å—Ö–µ–º–∞ `fas` –∏ —Ç–∞–±–ª–∏—Ü–∞ `fas.scoring_history` (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –±–æ—Ç–∞)

**Backup:**
```bash
database/migrations/001_init_schema.sql.backup_20251029
```

### 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ú–∏–≥—Ä–∞—Ü–∏–∏

**Test 1: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞ —á–∏—Å—Ç–æ–π –ë–î**
```bash
createdb fox_crypto_test
psql -U evgeniyyanvarskiy -d fox_crypto_test -f database/migrations/001_init_schema.sql
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –£–°–ü–ï–•
- 1 schema created (monitoring)
- 14 tables created
- 33+ indexes created
- 4 triggers created
- 1 foreign key created
- –ë–µ–∑ –æ—à–∏–±–æ–∫!

**Test 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã**
```sql
SELECT schemaname, COUNT(*)
FROM pg_tables
WHERE schemaname IN ('fas', 'monitoring')
GROUP BY schemaname;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
schemaname | count
------------+-------
 monitoring |    14
Total: 14 tables ‚úÖ
```

**Test 3: –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ (idempotency)**

‚ö†Ô∏è **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∑–∞–ø—É—Å–∫–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ë–î PostgreSQL –≤—ã–¥–∞–µ—Ç –æ—à–∏–±–∫–∏ "already exists" –¥–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤, —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ –∏ foreign keys. –≠—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, —Ç.–∫. PostgreSQL –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `CREATE INDEX IF NOT EXISTS` –¥–ª—è –≤—Å–µ—Ö –≤–µ—Ä—Å–∏–π.

**–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:** –ú–∏–≥—Ä–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ **—á–∏—Å—Ç–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö** –ø—Ä–∏ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏ –±–æ—Ç–∞.

---

## üìÑ –°–æ–∑–¥–∞–Ω–Ω–∞—è –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –ú–∏–≥—Ä–∞—Ü–∏—è
**–§–∞–π–ª:** `database/migrations/001_init_schema.sql`
- 1479 —Å—Ç—Ä–æ–∫
- –ü–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—Å–µ—Ö 15 —Ç–∞–±–ª–∏—Ü
- –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã, —Ç—Ä–∏–≥–≥–µ—Ä—ã, —Ñ—É–Ω–∫—Ü–∏–∏
- Foreign key constraints
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å PostgreSQL 14+ –∏ 15+

### 2. README –¥–ª—è –ú–∏–≥—Ä–∞—Ü–∏–π
**–§–∞–π–ª:** `database/migrations/README.md`

–°–æ–¥–µ—Ä–∂–∏—Ç:
- Quick start –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –∏ —Å—Ö–µ–º
- Environment variables
- –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- Production deployment steps
- Troubleshooting guide

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –°—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ fox_crypto
- ‚úÖ –ê–Ω–∞–ª–∏–∑ 3 schemas
- ‚úÖ –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è 15 tables
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ 2 functions
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ 4 triggers
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ 35+ indexes
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ 1 foreign key

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ú–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º—ã (1455 —Å—Ç—Ä–æ–∫)
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ Backup —Å—Ç–∞—Ä–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –ó–∞–º–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ PostgreSQL –≤–µ—Ä—Å–∏–π
- ‚ùå –£–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–π —Å—Ö–µ–º—ã `fas` –∏ —Ç–∞–±–ª–∏—Ü—ã `fas.scoring_history`

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- ‚úÖ –£—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ë–î –Ω–∞ —á–∏—Å—Ç–æ–π –±–∞–∑–µ
- ‚úÖ –í—Å–µ 14 —Ç–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –í—Å–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ Foreign key —Å–æ–∑–¥–∞–Ω
- ‚úÖ –ë–µ–∑ –æ—à–∏–±–æ–∫

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- ‚úÖ –°–æ–∑–¥–∞–Ω README.md –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
- ‚úÖ –°–æ–∑–¥–∞–Ω –æ—Ç—á–µ—Ç –æ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è Production Deployment

### –ù–∞ –ù–æ–≤–æ–º –°–µ—Ä–≤–µ—Ä–µ

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å PostgreSQL 14+ –∏–ª–∏ 15+
sudo apt-get install postgresql-15

# 2. –°–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
createdb fox_crypto

# 3. –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
createuser -P trading_user

# 4. –í—ã–¥–∞—Ç—å –ø—Ä–∞–≤–∞
psql -c "GRANT ALL PRIVILEGES ON DATABASE fox_crypto TO trading_user;"

# 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
psql -U trading_user -d fox_crypto -f database/migrations/001_init_schema.sql

# 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É
psql -U trading_user -d fox_crypto -c "
  SELECT schemaname, tablename
  FROM pg_tables
  WHERE schemaname IN ('fas', 'monitoring')
  ORDER BY schemaname, tablename;
"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** 15 tables (1 in fas, 14 in monitoring)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Environment Variables

–í `.env` —Ñ–∞–π–ª–µ:

```bash
DB_HOST=localhost
DB_PORT=5432
DB_NAME=fox_crypto
DB_USER=trading_user
DB_PASSWORD=your_secure_password
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ –∏ –ü–æ—Å–ª–µ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –°—Ç–∞—Ä–∞—è –ú–∏–≥—Ä–∞—Ü–∏—è | –ù–æ–≤–∞—è –ú–∏–≥—Ä–∞—Ü–∏—è |
|----------|----------------|----------------|
| –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ | ~35KB | 40KB |
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | 1306 | 1403 |
| Schemas | 1 (monitoring) | 1 (monitoring) |
| Tables | 13 | 14 |
| –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–æ | monitoring.params | - |
| –£–¥–∞–ª–µ–Ω–æ | - | fas.scoring_history (–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è) |
| –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å PostgreSQL | –û—à–∏–±–∫–∞ –≤ 15.13 | ‚úÖ 14+ –∏ 15+ |

---

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –î–µ—Ç–∞–ª–∏

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

**–ü—Ä–æ–±–ª–µ–º–∞:**
```sql
SET transaction_timeout = 0;  -- ‚ùå ERROR: unrecognized configuration parameter
```

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- SET transaction_timeout = 0;  -- Not available in all PostgreSQL builds
```

–ü–∞—Ä–∞–º–µ—Ç—Ä `transaction_timeout` –¥–æ–±–∞–≤–ª–µ–Ω –≤ PostgreSQL 14, –Ω–æ –Ω–µ –≤—Å–µ —Å–±–æ—Ä–∫–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ Homebrew –Ω–∞ macOS) –µ–≥–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç.

### –ö–ª—é—á–µ–≤—ã–µ –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ú–∏–≥—Ä–∞—Ü–∏–∏

1. **Idempotency –¥–ª—è —Å—Ö–µ–º –∏ —Ñ—É–Ω–∫—Ü–∏–π:**
   - `CREATE SCHEMA IF NOT EXISTS`
   - `CREATE OR REPLACE FUNCTION`

2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ timestamps:**
   - –¢—Ä–∏–≥–≥–µ—Ä—ã –Ω–∞ `updated_at` –¥–ª—è positions, trades, params

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è:**
   - –¢—Ä–∏–≥–≥–µ—Ä `normalize_side_trigger` –¥–ª—è lowercase —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏–∏

4. **Referential integrity:**
   - Foreign key —Å CASCADE DELETE –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏

5. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**
   - 35+ indexes –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏, —Å–∏–º–≤–æ–ª–∞–º, —Å—Ç–∞—Ç—É—Å–∞–º

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏

### –î–ª—è –õ–æ–∫–∞–ª—å–Ω–æ–π –†–∞–∑—Ä–∞–±–æ—Ç–∫–∏
–ú–∏–≥—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö `fox_crypto` —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç.

### –î–ª—è Production Deployment
1. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞
2. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
3. ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–π–¥–µ–Ω–æ
4. ‚è≥ –ñ–¥–µ—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–µ

### –î–ª—è –ë—É–¥—É—â–∏—Ö –û–±–Ω–æ–≤–ª–µ–Ω–∏–π –°—Ö–µ–º—ã

–ï—Å–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î –±—É–¥–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∞:

```bash
# 1. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ö–µ–º—É
pg_dump -h localhost -U evgeniyyanvarskiy -d fox_crypto \
  --schema-only --no-owner --no-privileges > /tmp/new_schema.sql

# 2. –û–±–Ω–æ–≤–∏—Ç—å 001_init_schema.sql –≤—Ä—É—á–Ω—É—é

# 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —á–∏—Å—Ç–æ–π –ë–î
createdb test_migration
psql -U evgeniyyanvarskiy -d test_migration -f database/migrations/001_init_schema.sql

# 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
psql -U evgeniyyanvarskiy -d test_migration -c "\dt monitoring.*"

# 5. –û—á–∏—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ë–î
dropdb test_migration
```

---

## üéØ –ò—Ç–æ–≥–∏

### –ß—Ç–æ –°–¥–µ–ª–∞–Ω–æ
1. ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î `fox_crypto`
2. ‚úÖ –ù–∞–π–¥–µ–Ω—ã –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã –≤ —Å—Ç–∞—Ä–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
3. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –ø–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (1479 —Å—Ç—Ä–æ–∫)
4. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å PostgreSQL –≤–µ—Ä—Å–∏–π
5. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –Ω–∞ —á–∏—Å—Ç–æ–π –ë–î
6. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è deployment

### –ì–∞—Ä–∞–Ω—Ç–∏–∏ –ö–∞—á–µ—Å—Ç–≤–∞
- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ PostgreSQL 15.13
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –≤—Å–µ 15 —Ç–∞–±–ª–∏—Ü –±–µ–∑ –æ—à–∏–±–æ–∫
- ‚úÖ –°–æ–∑–¥–∞–µ—Ç –≤—Å–µ –∏–Ω–¥–µ–∫—Å—ã, —Ç—Ä–∏–≥–≥–µ—Ä—ã, —Ñ—É–Ω–∫—Ü–∏–∏
- ‚úÖ –ì–æ—Ç–æ–≤–∞ –¥–ª—è production deployment
- ‚úÖ –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è DevOps

### –§–∞–π–ª—ã
1. `database/migrations/001_init_schema.sql` - –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è (1403 —Å—Ç—Ä–æ–∫–∏, 40KB)
2. `database/migrations/001_init_schema.sql.backup_20251029` - Backup —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏
3. `database/migrations/README.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è deployment
4. `docs/DATABASE_MIGRATION_VERIFICATION_20251029.md` - –≠—Ç–æ—Ç –æ—Ç—á–µ—Ç

---

**–ú–∏–≥—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –Ω–∞ production —Å–µ—Ä–≤–µ—Ä–∞—Ö!** üöÄ
