# üîç DEEP ANALYSIS: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ò–°–°–õ–ï–î–û–í–ê–ù–ò–Ø

### 1. –¢–ï–ö–£–©–ê–Ø –ü–†–û–ë–õ–ï–ú–ê (–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è)

**–§–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ü–û–°–õ–ï –æ—Ç–±–æ—Ä–∞ —Ç–æ–ø —Å–∏–≥–Ω–∞–ª–æ–≤, –∞ –Ω–µ –î–û**

```python
# signal_processor_websocket.py:903-922
# –¢–ï–ö–£–©–ò–ô –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô FLOW:
1. –°–æ—Ä—Ç–∏—Ä—É–µ–º –í–°–ï —Å–∏–≥–Ω–∞–ª—ã –ø–æ score
2. –ë–µ—Ä—ë–º —Ç–æ–ø N (—Å –±—É—Ñ–µ—Ä–æ–º) - –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ø 10
3. –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –¢–û–õ–¨–ö–û –∫ —ç—Ç–∏–º 10
4. –ò–∑ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏–∏
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ï—Å–ª–∏ –∏–∑ —Ç–æ–ø-10 –æ—Ç—Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è 6, –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ 4 –ø–æ–∑–∏—Ü–∏–∏ –≤–º–µ—Å—Ç–æ target=5
- –°–∏–≥–Ω–∞–ª—ã —Å –ø–æ–∑–∏—Ü–∏–π 11-20 –ù–ï –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –≤–æ–æ–±—â–µ, —Ö–æ—Ç—è –º–æ–≥–ª–∏ –±—ã –ø—Ä–æ–π—Ç–∏ —Ñ–∏–ª—å—Ç—Ä—ã
- –≠—Ç–æ —Ç–∞ –∂–µ –ø—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø—Ä–æ—Å–∏–ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å!

### 2. –ê–†–•–ò–¢–ï–ö–¢–£–†–ê WaveSignalProcessor

#### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç process_wave_signals():
1. –ü—Ä–æ—Ö–æ–¥–∏—Ç –ø–æ –∫–∞–∂–¥–æ–º—É —Å–∏–≥–Ω–∞–ª—É
2. –í—ã–∑—ã–≤–∞–µ—Ç `_is_duplicate()` –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –í–°–ï —Ñ–∏–ª—å—Ç—Ä—ã:
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã –ø–æ–∑–∏—Ü–∏–π
   - –§–∏–ª—å—Ç—Ä Open Interest (OI)
   - –§–∏–ª—å—Ç—Ä Volume
   - –§–∏–ª—å—Ç—Ä Price Change
3. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
   - `successful`: –ø—Ä–æ—à–µ–¥—à–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã (—Å–æ–¥–µ—Ä–∂–∏—Ç `signal_data`)
   - `skipped`: –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ (—Å–æ–¥–µ—Ä–∂–∏—Ç `reason`)
   - `failed`: –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

#### Side Effects (–≤–∞–∂–Ω–æ!):
1. **–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã** –≤ _process_single_signal():
   - `signal['action'] = action`
   - `signal['signal_type'] = action`
2. **–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ –ë–î** —á–µ—Ä–µ–∑ event_logger:
   - SIGNAL_FILTERED –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
   - –†–∞–∑–ª–∏—á–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞

### 3. –í–ê–†–ò–ê–ù–¢–´ –†–ï–®–ï–ù–ò–Ø

#### –í–∞—Ä–∏–∞–Ω—Ç A: –î–≤—É—Ö—ç—Ç–∞–ø–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (‚ùå –ù–ï –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ)
```
1. –í—ã–∑–≤–∞—Ç—å WaveSignalProcessor –¥–ª—è –í–°–ï–• —Å–∏–≥–Ω–∞–ª–æ–≤ (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è)
2. –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ score
3. –í–∑—è—Ç—å —Ç–æ–ø N
4. –û—Ç–∫—Ä—ã—Ç—å –ø–æ–∑–∏—Ü–∏–∏
```
**–ü—Ä–æ–±–ª–µ–º—ã:**
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –≤ –ë–î
- –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—Å–µ—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
- –õ–∏—à–Ω–∏–µ API –≤—ã–∑–æ–≤—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ OI/volume –≤—Å–µ—Ö —Å–∏–≥–Ω–∞–ª–æ–≤

#### –í–∞—Ä–∏–∞–Ω—Ç B: –ù–æ–≤—ã–π –º–µ—Ç–æ–¥ filter_only (‚úÖ –õ—É—á—à–µ)
```
1. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ filter_signals() –≤ WaveSignalProcessor
2. –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –¢–û–õ–¨–ö–û —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç, –Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç
3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ –í–°–ï–ú —Å–∏–≥–Ω–∞–ª–∞–º
4. –û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ –≤—ã–±—Ä–∞—Ç—å —Ç–æ–ø N
5. –í—ã–∑–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π process_wave_signals() –¥–ª—è —Ç–æ–ø N
```
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞

#### –í–∞—Ä–∏–∞–Ω—Ç C: –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã (‚úÖ‚úÖ –û–ü–¢–ò–ú–ê–õ–¨–ù–û)
```
1. –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä mode='filter'|'process' –≤ process_wave_signals()
2. –í —Ä–µ–∂–∏–º–µ 'filter' - —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤, –±–µ–∑ side effects
3. –í —Ä–µ–∂–∏–º–µ 'process' - –ø–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –∑–∞–ø–∏—Å—å—é –≤ –ë–î
```
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- –ì–∏–±–∫–æ—Å—Ç—å
- –õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 4. –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´ –ü–†–û–®–õ–´–• –ü–û–ü–´–¢–û–ö

1. **–°–æ–∑–¥–∞–Ω–∏–µ –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ –∫–æ–¥–∞** (SignalPipeline) –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** (entry_price=0)
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏** –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —ç—Ç–∞–ø–∞—Ö
4. **–ù–µ–ø–æ–Ω–∏–º–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã** –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏

### 5. –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ö –†–ï–®–ï–ù–ò–Æ

1. **–§–∏–ª—å—Ç—Ä—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –∫–æ –í–°–ï–ú —Å–∏–≥–Ω–∞–ª–∞–º**
2. **–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ score –ü–û–°–õ–ï —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**
3. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞**
4. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫**
5. **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–µ—Ç—Ä–∏–∫–∏**
6. **–û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases** (–Ω–µ—Ç —Å–∏–≥–Ω–∞–ª–æ–≤, –≤—Å–µ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã, etc)

### 6. –ó–ê–í–ò–°–ò–ú–û–°–¢–ò –ò –†–ò–°–ö–ò

#### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- WaveSignalProcessor –∑–∞–≤–∏—Å–∏—Ç –æ—Ç PositionManager
- PositionManager –∑–∞–≤–∏—Å–∏—Ç –æ—Ç ExchangeManager
- –§–∏–ª—å—Ç—Ä—ã —Ç—Ä–µ–±—É—é—Ç API –≤—ã–∑–æ–≤–æ–≤ –∫ –±–∏—Ä–∂–∞–º

#### –†–∏—Å–∫–∏:
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–æ–ª–Ω—ã (–±–æ–ª—å—à–µ API –≤—ã–∑–æ–≤–æ–≤)
- –í–æ–∑–º–æ–∂–Ω—ã–µ rate limits –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –≤—Å–µ—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö OI/volume

### 7. –ú–ï–¢–†–ò–ö–ò –î–õ–Ø –ü–†–û–í–ï–†–ö–ò

–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å –≤ –ª–æ–≥–∞—Ö:
```
Processing wave with 50 signals
Applied filters to ALL 50 signals
Filtered out: 20 (OI: 12, Volume: 8)
Remaining after filters: 30
Selected top 10 by score from 30 filtered
Opened 5 positions (target reached)
```

## üìã –î–ï–¢–ê–õ–¨–ù–´–ô –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –§–ê–ó–ê 1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤ WaveSignalProcessor

#### –®–∞–≥ 1.1: –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è process_wave_signals()
```python
async def process_wave_signals(
    self,
    signals: List[Dict],
    wave_timestamp: str = None,
    mode: str = 'process'  # NEW: 'filter' or 'process'
) -> Dict[str, Any]:
```

#### –®–∞–≥ 1.2: –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ –º–µ—Ç–æ–¥–µ
- –í —Ä–µ–∂–∏–º–µ 'filter':
  - –ù–ï –≤—ã–∑—ã–≤–∞—Ç—å _process_single_signal()
  - –ù–ï –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å–∏–≥–Ω–∞–ª—ã
  - –ù–ï –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –≤ –ë–î (–∏–ª–∏ —Ç–æ–ª—å–∫–æ summary)
  - –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –≤ successful
- –í —Ä–µ–∂–∏–º–µ 'process':
  - –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞

#### –®–∞–≥ 1.3: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ø–∏–π —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
```python
if mode == 'filter':
    # –†–∞–±–æ—Ç–∞–µ–º —Å –∫–æ–ø–∏—è–º–∏ —á—Ç–æ–±—ã –Ω–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—ã
    signal_copy = signal.copy()
```

### –§–ê–ó–ê 2: –ò–∑–º–µ–Ω–µ–Ω–∏–µ _process_wave_per_exchange()

#### –®–∞–≥ 2.1: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∫–æ –í–°–ï–ú —Å–∏–≥–Ω–∞–ª–∞–º
```python
# 1. –°–ù–ê–ß–ê–õ–ê —Ñ–∏–ª—å—Ç—Ä—É–µ–º –í–°–ï —Å–∏–≥–Ω–∞–ª—ã
filter_result = await self.wave_processor.process_wave_signals(
    signals=exchange_signals,  # –í–°–ï —Å–∏–≥–Ω–∞–ª—ã –±–∏—Ä–∂–∏
    wave_timestamp=wave_timestamp,
    mode='filter'  # –¢–æ–ª—å–∫–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
)

# 2. –ò–∑–≤–ª–µ–∫–∞–µ–º –ø—Ä–æ—à–µ–¥—à–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã
filtered_signals = [
    s['signal_data'] for s in filter_result.get('successful', [])
]
```

#### –®–∞–≥ 2.2: –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö
```python
# 3. –°–æ—Ä—Ç–∏—Ä—É–µ–º –¢–û–õ–¨–ö–û –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ
sorted_filtered = sorted(
    filtered_signals,
    key=lambda s: (s.get('score_week', 0) + s.get('score_month', 0)),
    reverse=True
)
```

#### –®–∞–≥ 2.3: –í—ã–±–æ—Ä —Ç–æ–ø N –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞
```python
# 4. –ë–µ—Ä—ë–º —Ç–æ–ø N –¥–ª—è –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è
signals_to_execute = sorted_filtered[:max_trades + buffer_extra]

# 5. –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö
process_result = await self.wave_processor.process_wave_signals(
    signals=signals_to_execute,
    wave_timestamp=wave_timestamp,
    mode='process'  # –ü–æ–ª–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å –∑–∞–ø–∏—Å—å—é –≤ –ë–î
)
```

### –§–ê–ó–ê 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–µ—Ç—Ä–∏–∫ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –®–∞–≥ 3.1: –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```python
total_signals = len(exchange_signals)
after_filters = len(filtered_signals)
filtered_out = total_signals - after_filters

# –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —Ç–∏–ø–∞–º —Ñ–∏–ª—å—Ç—Ä–æ–≤
filter_stats = {
    'low_oi': len([s for s in filter_result['skipped'] if 'OI' in s.get('reason', '')]),
    'low_volume': len([s for s in filter_result['skipped'] if 'volume' in s.get('reason', '')]),
    'duplicates': len([s for s in filter_result['skipped'] if 'duplicate' in s.get('reason', '')])
}
```

#### –®–∞–≥ 3.2: –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
logger.info(
    f"{exchange_name}: {total_signals} signals ‚Üí "
    f"{filtered_out} filtered (OI:{filter_stats['low_oi']}, "
    f"Vol:{filter_stats['low_volume']}, Dup:{filter_stats['duplicates']}) ‚Üí "
    f"{after_filters} passed ‚Üí {len(signals_to_execute)} selected ‚Üí "
    f"{executed}/{max_trades} executed"
)
```

### –§–ê–ó–ê 4: –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases

#### –®–∞–≥ 4.1: –í—Å–µ —Å–∏–≥–Ω–∞–ª—ã –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω—ã
```python
if not filtered_signals:
    logger.warning(f"‚ö†Ô∏è {exchange_name}: All {total_signals} signals filtered out!")
    continue
```

#### –®–∞–≥ 4.2: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–∏–≥–Ω–∞–ª–æ–≤ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
```python
if len(filtered_signals) < max_trades:
    logger.warning(
        f"‚ö†Ô∏è {exchange_name}: Only {len(filtered_signals)} signals passed filters, "
        f"target was {max_trades}"
    )
```

### –§–ê–ó–ê 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- –°–æ–∑–¥–∞—Ç—å 50 —Å–∏–≥–Ω–∞–ª–æ–≤
- 20 —Å –Ω–∏–∑–∫–∏–º OI
- 10 —Å –Ω–∏–∑–∫–∏–º volume
- 5 –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ 35, –æ—Å—Ç–∞–ª–æ—Å—å 15

#### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤—ã–±–∏—Ä–∞—é—Ç—Å—è —Å–∏–≥–Ω–∞–ª—ã —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º score

#### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è target
- –ü—Ä–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å–∏–≥–Ω–∞–ª–æ–≤ target –¥–æ–ª–∂–µ–Ω –¥–æ—Å—Ç–∏–≥–∞—Ç—å—Å—è

#### –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫
- –í—Å–µ —Å—á–µ—Ç—á–∏–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏

### –§–ê–ó–ê 6: Rollback –ø–ª–∞–Ω

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥–µ—Ç –Ω–µ —Ç–∞–∫:
1. –£–±—Ä–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä mode –∏–∑ –≤—ã–∑–æ–≤–æ–≤
2. –í–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É –≤ _process_wave_per_exchange
3. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—Ä–∞—Ç–∏–º—ã

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ú–û–ú–ï–ù–¢–´

1. **–ù–ï –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏**
2. **–ù–ï –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø–∏—Å–∏ –≤ –ë–î**
3. **–£—á–∏—Ç—ã–≤–∞—Ç—å rate limits –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –≤—Å–µ—Ö —Å–∏–≥–Ω–∞–ª–æ–≤**
4. **–ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∫–æ–ø–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤**
5. **–°–æ—Ö—Ä–∞–Ω—è—Ç—å –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**

## ‚úÖ –û–ñ–ò–î–ê–ï–ú–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- –§–∏–ª—å—Ç—Ä—ã –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–æ –í–°–ï–ú —Å–∏–≥–Ω–∞–ª–∞–º
- –í—ã–±–∏—Ä–∞—é—Ç—Å—è –ª—É—á—à–∏–µ –∏–∑ –ü–†–û–®–ï–î–®–ò–• —Ñ–∏–ª—å—Ç—Ä—ã
- Target –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤–∞–ª–∏–¥–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤
- –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –≤ –ª–æ–≥–∞—Ö –æ —Ç–æ–º, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
- –ù–∏–∫–∞–∫–∏—Ö –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–π –∏ side effects

## üìà –ü–†–ï–ò–ú–£–©–ï–°–¢–í–ê –ü–û–î–•–û–î–ê

1. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
2. **–ì–∏–±–∫–æ—Å—Ç—å** - —Ä–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
3. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∂–¥—ã–π —ç—Ç–∞–ø
4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏
5. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏