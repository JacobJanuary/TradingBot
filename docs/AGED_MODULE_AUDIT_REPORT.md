# üìä –ê–£–î–ò–¢ AGED MODULE V2 - –û–¢–ß–Å–¢

**–î–∞—Ç–∞:** 2025-10-23
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û –°–û–û–¢–í–ï–¢–°–¢–í–£–ï–¢ –¢–ó

---

## üìã –¢–†–ï–ë–û–í–ê–ù–ò–Ø –ü–û –¢–ó

1. **Aged –º–æ–¥—É–ª—å –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ü–µ–Ω—ã –ø—Ä–∏ –ö–ê–ñ–î–û–ú –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç WebSocket** (–∫–∞–∫ TrailingStop)
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MARKET –æ—Ä–¥–µ—Ä–∞ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è (–Ω–µ LIMIT)
3. –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π —Ü–µ–Ω—ã

---

## ‚úÖ –ß–¢–û –†–ê–ë–û–¢–ê–ï–¢ –ü–†–ê–í–ò–õ–¨–ù–û

### 1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω –¥–ª—è –ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–ù–ù–´–• aged –ø–æ–∑–∏—Ü–∏–π**
```
WebSocket ‚Üí _on_position_update ‚Üí handle_unified_price_update ‚Üí
‚Üí UnifiedPriceMonitor ‚Üí AgedAdapter._on_unified_price ‚Üí
‚Üí AgedMonitorV2.check_price_target
```
**‚úÖ –¶–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ö–ê–ñ–î–û–ú –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –æ—Ç WebSocket (–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)**

### 2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ MARKET –æ—Ä–¥–µ—Ä–æ–≤**
```python
# aged_position_monitor_v2.py:189-194
order = await exchange.exchange.create_order(
    symbol=symbol,
    type='market',  # ‚úÖ MARKET –æ—Ä–¥–µ—Ä
    side=close_side,
    amount=amount,
    params=params
)
```
**‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è MARKET –æ—Ä–¥–µ—Ä–∞ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)**

### 3. **–õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∞—Ä–≥–µ—Ç–æ–≤**
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø—Ä–æ—Ñ–∏—Ç–Ω–æ—Å—Ç—å (–µ—Å–ª–∏ > 0 - –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å—Ä–∞–∑—É)
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ü–µ–ª–µ–≤–æ–π —Ü–µ–Ω—ã
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç LONG –∏ SHORT –ø–æ–∑–∏—Ü–∏–∏
**‚úÖ –õ–æ–≥–∏–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞**

---

## ‚ùå –ì–õ–ê–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê - –û–ë–ù–ê–†–£–ñ–ï–ù–ò–ï AGED –ü–û–ó–ò–¶–ò–ô

### **–ü—Ä–æ–±–ª–µ–º–∞:**
–ù–æ–≤—ã–µ aged –ø–æ–∑–∏—Ü–∏–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ä–∞–∑ –≤ **2 –ú–ò–ù–£–¢–´** (sync_interval = 120 —Å–µ–∫—É–Ω–¥)!

### **–ö–∞–∫ —Å–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
–ö–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã:
start_periodic_sync ‚Üí check_and_register_aged_positions ‚Üí
‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –í–°–ï –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ –≤–æ–∑—Ä–∞—Å—Ç
‚Üí –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–µ aged –ø–æ–∑–∏—Ü–∏–∏
```

### **–í —á—ë–º –ø—Ä–æ–±–ª–µ–º–∞:**
1. –ü–æ–∑–∏—Ü–∏—è –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å aged (> 3 —á–∞—Å–æ–≤) –≤ 12:00:00
2. –ù–æ –±—É–¥–µ—Ç –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –≤ 12:02:00 (—Å–ª–µ–¥—É—é—â–∏–π sync)
3. **–ü–û–¢–ï–†–Ø 2 –ú–ò–ù–£–¢** –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏!

---

## üîÑ –¢–ï–ö–£–©–ê–Ø –ß–ê–°–¢–û–¢–ê –û–ë–ù–û–í–õ–ï–ù–ò–ô

| –û–ø–µ—Ä–∞—Ü–∏—è | –ß–∞—Å—Ç–æ—Ç–∞ | –ü—Ä–∞–≤–∏–ª—å–Ω–æ? |
|----------|---------|------------|
| **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω –¥–ª—è aged** | –ü—Ä–∏ –∫–∞–∂–¥–æ–º WebSocket update | ‚úÖ –î–ê |
| **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö aged** | –ö–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã | ‚ùå –ù–ï–¢ |
| **–ó–∞–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏ —Ç–∞—Ä–≥–µ—Ç–µ** | –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ | ‚úÖ –î–ê |

---

## üö® –†–ò–°–ö–ò –¢–ï–ö–£–©–ï–ô –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

1. **–ó–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 2 –º–∏–Ω—É—Ç** –≤ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ aged –ø–æ–∑–∏—Ü–∏–π
2. **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É–±—ã—Ç–∫–∏** –µ—Å–ª–∏ —Ü–µ–Ω–∞ –∏–∑–º–µ–Ω–∏—Ç—Å—è –∑–∞ —ç—Ç–∏ 2 –º–∏–Ω—É—Ç—ã
3. **–ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó** - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è

---

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

### **–í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ü–µ–Ω—ã (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)**

–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤–æ–∑—Ä–∞—Å—Ç–∞ –ø–æ–∑–∏—Ü–∏–∏ –ø—Ä–∏ –ö–ê–ñ–î–û–ú –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:

```python
# –í position_manager.py, –≤ _on_position_update –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã:

if self.unified_protection:
    # –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
    await handle_unified_price_update(...)

    # –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ —Å—Ç–∞–ª–∞ –ª–∏ –ø–æ–∑–∏—Ü–∏—è aged
    aged_monitor = self.unified_protection.get('aged_monitor')
    if aged_monitor and await aged_monitor.check_position_age(position):
        # –ü–æ–∑–∏—Ü–∏—è —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å—Ç–∞–ª–∞ aged - —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º
        aged_adapter = self.unified_protection.get('aged_adapter')
        if symbol not in aged_monitor.aged_targets:
            await aged_monitor.add_aged_position(position)
            await aged_adapter.add_aged_position(position)
            logger.info(f"‚è∞ Position {symbol} just became aged!")
```

### **–í–∞—Ä–∏–∞–Ω—Ç 2: –£–º–µ–Ω—å—à–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏**

–ò–∑–º–µ–Ω–∏—Ç—å sync_interval –Ω–∞ 30 —Å–µ–∫—É–Ω–¥:
```python
self.sync_interval = 30  # –ë—ã–ª–æ 120
```

**–ú–∏–Ω—É—Å—ã:** –í—Å—ë –µ—â—ë –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 30 —Å–µ–∫—É–Ω–¥

### **–í–∞—Ä–∏–∞–Ω—Ç 3: –û—Ç–¥–µ–ª—å–Ω—ã–π –±—ã—Å—Ç—Ä—ã–π —Ü–∏–∫–ª –¥–ª—è aged**

–°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—É—é –∑–∞–¥–∞—á—É –ø—Ä–æ–≤–µ—Ä–∫–∏ aged —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 10 —Å–µ–∫—É–Ω–¥:
```python
async def fast_aged_check_loop(self):
    while True:
        await asyncio.sleep(10)  # –ö–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
        if self.unified_protection:
            await check_and_register_aged_positions(self, self.unified_protection)
```

---

## üìä –°–†–ê–í–ù–ï–ù–ò–ï –° TRAILING STOP

| –ê—Å–ø–µ–∫—Ç | TrailingStop | Aged Module | –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ |
|--------|--------------|-------------|--------------|
| **–ê–∫—Ç–∏–≤–∞—Ü–∏—è** | –ü—Ä–∏ PnL > 1.5% (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ) | –ü—Ä–∏ age > 3h (–∑–∞–¥–µ—Ä–∂–∫–∞ 2 –º–∏–Ω) | ‚ùå |
| **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω** | –ü—Ä–∏ –∫–∞–∂–¥–æ–º WebSocket | –ü—Ä–∏ –∫–∞–∂–¥–æ–º WebSocket | ‚úÖ |
| **–ó–∞–∫—Ä—ã—Ç–∏–µ** | MARKET –æ—Ä–¥–µ—Ä | MARKET –æ—Ä–¥–µ—Ä | ‚úÖ |
| **–†–µ–∞–∫—Ü–∏—è** | –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è | –ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ - –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è | ‚ö†Ô∏è |

---

## üéØ –í–´–í–û–î–´

1. **Aged Module V2 —Ä–∞–±–æ—Ç–∞–µ—Ç –ü–†–ê–í–ò–õ–¨–ù–û –¥–ª—è —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π**
   - –¶–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º WebSocket –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ ‚úÖ
   - –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è MARKET –æ—Ä–¥–µ—Ä–∞ ‚úÖ
   - –õ–æ–≥–∏–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ ‚úÖ

2. **–ì–õ–ê–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê - –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö aged –ø–æ–∑–∏—Ü–∏–π**
   - –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 2 –º–∏–Ω—É—Ç ‚ùå
   - –ù–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–π —Ä–µ–∞–∫—Ü–∏–∏ ‚ùå

3. **–†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø:**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **–í–∞—Ä–∏–∞–Ω—Ç 1** - –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ü–µ–Ω—ã
   - –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ aged –ø–æ–∑–∏—Ü–∏–π
   - –ü–æ–ª–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¢–ó

---

## üìà –ú–ï–¢–†–ò–ö–ò –î–õ–Ø –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:
- `aged_detection_delay` - –∑–∞–¥–µ—Ä–∂–∫–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å < 1 —Å–µ–∫)
- `aged_positions_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ aged –ø–æ–∑–∏—Ü–∏–π
- `aged_closes_per_hour` - —á–∞—Å—Ç–æ—Ç–∞ –∑–∞–∫—Ä—ã—Ç–∏–π
- `aged_market_order_success_rate` - —É—Å–ø–µ—à–Ω–æ—Å—Ç—å MARKET –æ—Ä–¥–µ—Ä–æ–≤

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª:** AI Assistant
**–î–∞—Ç–∞:** 2025-10-23
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–Ω–µ–¥—Ä–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è aged –ø–æ–∑–∏—Ü–∏–π