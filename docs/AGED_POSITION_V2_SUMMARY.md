# AGED POSITION MANAGER V2: –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–£–î–ò–¢–ê

### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è - –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

#### 1. LIMIT –æ—Ä–¥–µ—Ä–∞ –±–ª–æ–∫–∏—Ä—É—é—Ç –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å
- **–§–∞–π–ª**: `core/aged_position_manager.py` (756 —Å—Ç—Ä–æ–∫)
- **–ü—Ä–æ–±–ª–µ–º–∞**: –°—Ç—Ä–æ–∫–∏ 572-673, –º–µ—Ç–æ–¥ `_update_single_exit_order()`
- **–≠—Ñ—Ñ–µ–∫—Ç**: –ü–æ–∑–∏—Ü–∏—è —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –æ—Ä–¥–µ—Ä, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –¥—Ä—É–≥–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏

#### 2. –ù–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–∏ –∑–∞–∫—Ä—ã—Ç–∏—è
- **–ö–æ–¥**:
```python
# –°—Ç—Ä–æ–∫–∞ 593-594
order = await enhanced_manager.create_or_update_exit_order(
    price=precise_price,  # LIMIT –ø–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ü–µ–Ω–µ
```
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ —Ü–µ–Ω–∞ –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç target_price, –ø–æ–∑–∏—Ü–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç–æ–π –Ω–∞–≤–µ—á–Ω–æ

#### 3. –í—Ä–µ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ö–û–†–†–ï–ö–¢–ù–ê
- ‚úÖ –§–∞–∑—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (—Å—Ç—Ä–æ–∫–∏ 415-519)
- ‚úÖ Grace period = 8 —á–∞—Å–æ–≤
- ‚úÖ Progressive liquidation —Å —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º
- ‚úÖ MARKET –æ—Ä–¥–µ—Ä–∞ –¥–ª—è profitable –∏ emergency

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π
- **–í—ã–∑–æ–≤**: –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –∏–∑ `main.py` (—Å—Ç—Ä–æ–∫–∞ 513)
- **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ**: –° TrailingStopManager, PositionManager, Repository
- **–ü—Ä–æ–≤–µ—Ä–∫–∏**: –ü—Ä–æ–ø—É—Å–∫–∞–µ—Ç –ø–æ–∑–∏—Ü–∏–∏ —Å –∞–∫—Ç–∏–≤–Ω—ã–º TS, —É–¥–∞–ª—è–µ—Ç —Ñ–∞–Ω—Ç–æ–º–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏

---

## üí° –ù–û–í–û–ï –†–ï–®–ï–ù–ò–ï: WebSocket Monitoring + MARKET Execution

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ V2

```
1. DETECTION (—Ä–∞–∑ –≤ —á–∞—Å) ‚Üí –ù–∞—Ö–æ–¥–∏–º aged –ø–æ–∑–∏—Ü–∏–∏
2. MONITORING (real-time) ‚Üí WebSocket –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç —Ü–µ–Ω—ã
3. TRIGGER (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ) ‚Üí –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ target_price
4. EXECUTE (MARKET) ‚Üí –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ
```

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |
|-----------|------------|----------------------|
| **AgedPositionDetector** | –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –ø–æ–∑–∏—Ü–∏–π | ‚úÖ –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω |
| **AgedPositionMonitor** | Real-time –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ WebSocket | ‚úÖ –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω |
| **AgedPositionCloser** | MARKET –∑–∞–∫—Ä—ã—Ç–∏–µ —Å retry | ‚úÖ –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω |
| **AgedPositionStateManager** | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –∏ –ë–î | ‚úÖ –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω |
| **AgedPositionTickerStream** | WebSocket ticker –ø–æ–¥–ø–∏—Å–∫–∏ | ‚úÖ –°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω |

---

## üóÑÔ∏è –ë–ê–ó–ê –î–ê–ù–ù–´–•

### –ù–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã

1. **monitoring.aged_positions** - –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ tracking
   - 35+ –ø–æ–ª–µ–π –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
   - –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –ø–æ position_id
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π timestamp update

2. **monitoring.aged_positions_history** - –ò—Å—Ç–æ—Ä–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ trigger
   - –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–π

3. **monitoring.aged_positions_monitoring** - Real-time —Å–æ–±—ã—Ç–∏—è
   - –ö–∞–∂–¥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–Ω—ã
   - –†–µ—à–µ–Ω–∏—è –æ –∑–∞–∫—Ä—ã—Ç–∏–∏

### SQL –º–∏–≥—Ä–∞—Ü–∏—è
- **–§–∞–π–ª**: `database/migrations/009_create_aged_positions_tables.sql`
- **–†–∞–∑–º–µ—Ä**: 700+ —Å—Ç—Ä–æ–∫ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏, —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏, views

---

## üìà –û–ñ–ò–î–ê–ï–ú–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ | –û–∂–∏–¥–∞–µ–º–æ–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|---------|-----------|-----------|
| **–í—Ä–µ–º—è —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Ü–µ–Ω—É** | 5 –º–∏–Ω—É—Ç | <1 —Å–µ–∫—É–Ω–¥–∞ | **300x –±—ã—Å—Ç—Ä–µ–µ** |
| **Success rate –∑–∞–∫—Ä—ã—Ç–∏—è** | ~60% | >95% | **+35%** |
| **–°—Ä–µ–¥–Ω–∏–π —É–±—ã—Ç–æ–∫** | -3.5% | -2.0% | **-43%** |
| **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–∑–∏—Ü–∏–π** | –î–∞ | –ù–µ—Ç | **‚úÖ** |

### –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å

- ‚úÖ **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ** —á–µ—Ä–µ–∑ MARKET –æ—Ä–¥–µ—Ä–∞
- ‚úÖ **Recovery –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞** - –ø–æ–ª–Ω–∞—è persistence –≤ –ë–î
- ‚úÖ **Auto-reconnect WebSocket** —Å exponential backoff
- ‚úÖ **Fallback –Ω–∞ polling** –¥–ª—è testnet

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

- **Prometheus –º–µ—Ç—Ä–∏–∫–∏** –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **Grafana dashboard** —Å real-time —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
- **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤—Å–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π
- **Alerting** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∑–∞–∫—Ä—ã—Ç–∏—è

---

## üìù –ü–õ–ê–ù –í–ù–ï–î–†–ï–ù–ò–Ø

### –§–∞–∑—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

| –§–∞–∑–∞ | –°—Ä–æ–∫ | –°—Ç–∞—Ç—É—Å |
|------|------|--------|
| 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ë–î | 1-2 –¥–Ω—è | üü° Ready to start |
| 2. Core –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã | 3-4 –¥–Ω—è | üü° Designed |
| 3. WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | 2-3 –¥–Ω—è | üü° Designed |
| 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ | 3-4 –¥–Ω—è | üü° Designed |
| 5. –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è | 2 –¥–Ω—è | üü° Designed |
| 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | 3-5 –¥–Ω–µ–π | üî¥ Pending |
| 7. Deployment | 2-3 –¥–Ω—è | üî¥ Pending |

**–û–±—â–∏–π —Å—Ä–æ–∫**: 3-5 –Ω–µ–¥–µ–ª—å

### Deployment —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

1. **Feature flag** `USE_AGED_V2=false`
2. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å—Ç–∞—Ä–æ–π –∏ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º
3. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ** –ø–æ —Å–∏–º–≤–æ–ª–∞–º
4. **–ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥** –ø–æ—Å–ª–µ 2 –Ω–µ–¥–µ–ª—å —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã

---

## ‚úÖ DELIVERABLES

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (–ì–û–¢–û–í–û)

| –î–æ–∫—É–º–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –§–∞–π–ª |
|----------|----------|------|
| **–ê—É–¥–∏—Ç –∏ –¥–∏–∑–∞–π–Ω** | –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –Ω–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ | `AGED_POSITION_MANAGER_V2_REDESIGN.md` |
| **–ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** | –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Å –∫–æ–¥–æ–º | `AGED_POSITION_V2_IMPLEMENTATION_PLAN.md` |
| **SQL –º–∏–≥—Ä–∞—Ü–∏—è** | –°—Ö–µ–º–∞ –ë–î –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ | `009_create_aged_positions_tables.sql` |
| **–ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç** | –î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç | `AGED_POSITION_V2_SUMMARY.md` |

### –ö–æ–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–ü–†–ò–ú–ï–†–´)

- ‚úÖ **Pydantic –º–æ–¥–µ–ª–∏** - –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ **StateManager** - 300+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
- ‚úÖ **TickerStream** - WebSocket –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ **Monitor** - Real-time –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- ‚úÖ **Migration script** - –î–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ —Å V1

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### Immediate (–î–µ–Ω—å 1-2)
```bash
# 1. –°–æ–∑–¥–∞—Ç—å feature branch
git checkout -b feature/aged-positions-v2

# 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î
psql -d trading_bot -f database/migrations/009_create_aged_positions_tables.sql

# 3. –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤
mkdir -p core/aged_v2
touch core/aged_v2/__init__.py
touch core/aged_v2/state_manager.py
touch core/aged_v2/detector.py
touch core/aged_v2/monitor.py
touch core/aged_v2/closer.py
```

### Development (–ù–µ–¥–µ–ª—è 1-2)
1. –ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å StateManager
2. –°–æ–∑–¥–∞—Ç—å unit —Ç–µ—Å—Ç—ã
3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å WebSocket stream
4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ testnet

### Testing (–ù–µ–¥–µ–ª—è 3)
1. Integration —Ç–µ—Å—Ç—ã
2. Load —Ç–µ—Å—Ç—ã (50+ –ø–æ–∑–∏—Ü–∏–π)
3. Failover —Å—Ü–µ–Ω–∞—Ä–∏–∏
4. Performance benchmarks

### Deployment (–ù–µ–¥–µ–ª—è 4-5)
1. Code review
2. Staging deployment
3. Production —Å feature flag
4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

---

## üìä –†–ò–°–ö–ò –ò –ú–ò–¢–ò–ì–ê–¶–ò–Ø

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|-----------|
| **WebSocket –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** | –°—Ä–µ–¥–Ω—è—è | Auto-reconnect, fallback –Ω–∞ polling |
| **–ë–î performance** | –ù–∏–∑–∫–∞—è | –ò–Ω–¥–µ–∫—Å—ã, connection pooling |
| **Race conditions** | –°—Ä–µ–¥–Ω—è—è | –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, idempotent –æ–ø–µ—Ä–∞—Ü–∏–∏ |
| **–û—à–∏–±–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–∏** | –ù–∏–∑–∫–∞—è | Backup, rollback –ø–ª–∞–Ω |

---

## üéØ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ
- ‚úÖ –í—Å–µ aged –ø–æ–∑–∏—Ü–∏–∏ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤
- ‚úÖ Success rate > 95%
- ‚úÖ –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç–∏
- ‚úÖ Recovery –ø–æ—Å–ª–µ —Ä–µ—Å—Ç–∞—Ä—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ë–∏–∑–Ω–µ—Å
- üìà –°–Ω–∏–∂–µ–Ω–∏–µ —É–±—ã—Ç–∫–æ–≤ –Ω–∞ 30-40%
- üìà –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –∫–∞–ø–∏—Ç–∞–ª–∞ –±—ã—Å—Ç—Ä–µ–µ
- üìà –£–ø—Ä–æ—â–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏—è–º–∏
- üìà –°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–æ–≤ –∑–∞—Å—Ç—Ä—è–≤—à–∏—Ö –ø–æ–∑–∏—Ü–∏–π

---

## üí¨ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è aged position manager –∏–º–µ–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ LIMIT –æ—Ä–¥–µ—Ä–æ–≤ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å –∏ –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∑–∞–∫—Ä—ã—Ç–∏–µ –ø–æ–∑–∏—Ü–∏–π.

–ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ V2 —Å WebSocket –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –∏ MARKET –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ–º —Ä–µ—à–∞–µ—Ç –≤—Å–µ –≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
- **–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è** –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã
- **–ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ** —á–µ—Ä–µ–∑ MARKET –æ—Ä–¥–µ—Ä–∞
- **–ü–æ–ª–Ω–∞—è observability** —á–µ—Ä–µ–∑ –º–µ—Ç—Ä–∏–∫–∏ –∏ –ª–æ–≥–∏
- **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** —Å recovery –∏ fallback –º–µ—Ö–∞–Ω–∏–∑–º–∞–º–∏

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–π–º–µ—Ç 3-5 –Ω–µ–¥–µ–ª—å —Å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–º –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ feature flags. –û–∂–∏–¥–∞–µ–º–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —É–±—ã—Ç–∫–æ–≤ –Ω–∞ 30-40% –∏ –ø–æ–≤—ã—à–µ–Ω–∏–µ success rate –¥–æ 95%+.

---

## üìÅ –§–ê–ô–õ–û–í–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

```
TradingBot/
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ aged_position_manager.py (—Ç–µ–∫—É—â–∏–π - –±—É–¥–µ—Ç deprecated)
‚îÇ   ‚îî‚îÄ‚îÄ aged_v2/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ state_manager.py
‚îÇ       ‚îú‚îÄ‚îÄ detector.py
‚îÇ       ‚îú‚îÄ‚îÄ monitor.py
‚îÇ       ‚îú‚îÄ‚îÄ closer.py
‚îÇ       ‚îî‚îÄ‚îÄ manager.py
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ aged_position.py
‚îú‚îÄ‚îÄ websocket/
‚îÇ   ‚îî‚îÄ‚îÄ aged_ticker_stream.py
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ       ‚îî‚îÄ‚îÄ 009_create_aged_positions_tables.sql
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ migrate_aged_positions.py
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îî‚îÄ‚îÄ test_aged_position_v2.py
‚îî‚îÄ‚îÄ docs/
    ‚îú‚îÄ‚îÄ AGED_POSITION_MANAGER_V2_REDESIGN.md
    ‚îú‚îÄ‚îÄ AGED_POSITION_V2_IMPLEMENTATION_PLAN.md
    ‚îî‚îÄ‚îÄ AGED_POSITION_V2_SUMMARY.md
```

---

*–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω: 2025-10-23*
*–ê–≤—Ç–æ—Ä: AI Assistant*
*–°—Ç–∞—Ç—É—Å: –ì–û–¢–û–í –ö –†–ï–ê–õ–ò–ó–ê–¶–ò–ò*