# üîç –ì–õ–£–ë–û–ö–ò–ô –ê–£–î–ò–¢: –ö–ê–ö –£–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–¢–°–Ø LEVERAGE

**–î–∞—Ç–∞:** 2025-10-25
**–¶–µ–ª—å:** –í—ã—è—Å–Ω–∏—Ç—å –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –∑–∞–¥–∞—ë—Ç—Å—è leverage –¥–ª—è –ø–æ–∑–∏—Ü–∏–π
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ö†Ô∏è **–ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –û–¢–ö–†–´–¢–ò–ï** - Leverage –ù–ï –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è –±–æ—Ç–æ–º!

---

## üéØ –ì–õ–ê–í–ù–´–ô –í–´–í–û–î

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ LEVERAGE –ù–ï –£–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–¢–°–Ø –ü–†–û–ì–†–ê–ú–ú–ù–û!                         ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ –ë–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç leverage, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –í–†–£–ß–ù–£–Æ –Ω–∞ –±–∏—Ä–∂–µ.         ‚îÇ
‚îÇ –ö–∞–∂–¥—ã–π —Å–∏–º–≤–æ–ª –∏–º–µ–µ—Ç –°–í–û–ô leverage, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å   ‚îÇ
‚îÇ —á–µ—Ä–µ–∑ UI –±–∏—Ä–∂–∏ –¥–ª—è –ö–ê–ñ–î–û–ì–û —Å–∏–º–≤–æ–ª–∞ –æ—Ç–¥–µ–ª—å–Ω–æ!                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìã –ß–¢–û –Ø –ü–†–û–í–ï–†–ò–õ

### 1Ô∏è‚É£ –í—Å–µ —Ç–æ—á–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–¥–µ—Ä–æ–≤ (23 –º–µ—Å—Ç–∞)

–ü—Ä–æ–≤–µ—Ä–∏–ª –≤—Å–µ –≤—ã–∑–æ–≤—ã `create_order`, `create_market_order`, `create_limit_order`:

**–§–∞–π–ª—ã —Å —Å–æ–∑–¥–∞–Ω–∏–µ–º –æ—Ä–¥–µ—Ä–æ–≤:**
- ‚úÖ `core/position_manager.py` - –æ—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ `core/atomic_position_manager.py` - –∞—Ç–æ–º–∞—Ä–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ
- ‚úÖ `core/order_executor.py` - –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ —Å retry –ª–æ–≥–∏–∫–æ–π
- ‚úÖ `core/exchange_manager.py` - –æ–±—ë—Ä—Ç–∫–∏ –Ω–∞–¥ CCXT
- ‚úÖ `core/aged_position_manager.py` - –∑–∞–∫—Ä—ã—Ç–∏–µ aged –ø–æ–∑–∏—Ü–∏–π
- ‚úÖ `core/stop_loss_manager.py` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ SL
- ‚úÖ `protection/trailing_stop.py` - —Ç—Ä–µ–π–ª–∏–Ω–≥ —Å—Ç–æ–ø—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå **–ù–ò –í –û–î–ù–û–ú –º–µ—Å—Ç–µ –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä `leverage`!**

---

### 2Ô∏è‚É£ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ä–¥–µ—Ä–æ–≤

–ü—Ä–æ–≤–µ—Ä–∏–ª –≤—Å–µ `params = {...}` –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ä–¥–µ—Ä–æ–≤.

**–ß—Ç–æ –†–ï–ê–õ–¨–ù–û –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è:**

```python
# –ü—Ä–∏–º–µ—Ä –∏–∑ order_executor.py
params = {
    'reduceOnly': True,        # ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
    'timeInForce': 'IOC'       # ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
    # 'leverage': ???           # ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢!
}

# –ü—Ä–∏–º–µ—Ä –∏–∑ aged_position_manager.py
params = {
    'reduceOnly': True
    # 'leverage': ???           # ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢!
}

# –ü—Ä–∏–º–µ—Ä –∏–∑ exchange_manager.py - stop loss
params = {
    'stopPrice': float(stop_price),
    'reduceOnly': True,
    'workingType': 'CONTRACT_PRICE'
    # 'leverage': ???           # ‚ùå –û–¢–°–£–¢–°–¢–í–£–ï–¢!
}
```

**–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ params:**
- ‚úÖ `reduceOnly: True` - –≤—Å–µ–≥–¥–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
- ‚úÖ `timeInForce: IOC/GTC/PostOnly` - –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –æ—Ä–¥–µ—Ä–∞
- ‚úÖ `category: 'linear'` - –¥–ª—è Bybit
- ‚úÖ `stopPrice` - –¥–ª—è —Å—Ç–æ–ø-–ª–æ—Å—Å–æ–≤
- ‚úÖ `postOnly: True` - –¥–ª—è maker –æ—Ä–¥–µ—Ä–æ–≤
- ‚ùå **`leverage` - –ù–ò–ì–î–ï –ù–ï–¢!**

---

### 3Ô∏è‚É£ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Exchange

–ü—Ä–æ–≤–µ—Ä–∏–ª `ExchangeManager.__init__()` –∏ `ExchangeManager.initialize()`.

**core/exchange_manager.py:74-165:**

```python
def __init__(self, exchange_name: str, config: Dict, repository=None):
    # ... –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è CCXT ...

    exchange_options = {
        'apiKey': api_key,
        'secret': api_secret,
        'enableRateLimit': config.get('rate_limit', True),
        'options': {
            'defaultType': 'future',
            'adjustForTimeDifference': True,
            'recvWindow': 10000,
        }
    }

    # Binance specific
    if self.name == 'binance':
        exchange_options['options']['fetchPositions'] = 'positionRisk'

    # Bybit specific
    elif self.name == 'bybit':
        exchange_options['options']['accountType'] = 'UNIFIED'
        exchange_options['options']['defaultType'] = 'future'
        exchange_options['options']['brokerId'] = ''  # Disable brokerId

    self.exchange = exchange_class(exchange_options)

    # ‚ùå –ù–ï–¢ –≤—ã–∑–æ–≤–∞ set_leverage()!
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå **–ù–ò –†–ê–ó–£ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `set_leverage()`!**

---

### 4Ô∏è‚É£ –í—ã–∑–æ–≤—ã set_leverage –≤ –∫–æ–¥–µ

–ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º—É –∫–æ–¥—É:

```bash
$ grep -r "set_leverage\|setLeverage" --include="*.py" | grep -v ".venv" | grep -v "test_" | grep -v ".backup"

./core/bybit_zombie_cleaner.py:317:  # Use CCXT's set_leverage method with special params for trading-stop
```

**–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ** - —ç—Ç–æ **–æ—à–∏–±–æ—á–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π**!

–ü—Ä–æ–≤–µ—Ä–∏–º —ç—Ç–æ—Ç —Ñ–∞–π–ª:

```python
# core/bybit_zombie_cleaner.py:317
# Use CCXT's set_leverage method with special params for trading-stop
# ‚¨ÜÔ∏è –ù–ï–ü–†–ê–í–ò–õ–¨–ù–´–ô –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ô!

# –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —Ç–∞–º –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:
response = await self.exchange.private_post_v5_position_trading_stop(params)
# ‚¨ÜÔ∏è –≠—Ç–æ –ù–ï set_leverage, —ç—Ç–æ trading-stop endpoint!
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚ùå **`set_leverage()` –ù–ò –†–ê–ó–£ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è!**

---

## üî¨ –≠–ö–°–ü–ï–†–ò–ú–ï–ù–¢: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ leverage

–ü–æ–¥–∫–ª—é—á–∏–ª—Å—è –∫ –±–∏—Ä–∂–∞–º –∏ –ø—Ä–æ–≤–µ—Ä–∏–ª –∫–∞–∫–æ–π leverage –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –°–ï–ô–ß–ê–°:

### Binance Testnet - –†–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

```
SNTUSDT        : 20x leverage
CGPTUSDT       : 10x leverage
SUSHIUSDT      : 10x leverage
TRUTHUSDT      : 20x leverage
STRAXUSDT      : 20x leverage
```

### Bybit Testnet - –†–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:

```
OKB/USDT:USDT  : 10.0x leverage
BOBA/USDT:USDT : 10.0x leverage
ALEO/USDT:USDT : 10.0x leverage
AGI/USDT:USDT  : 10.0x leverage
XDC/USDT:USDT  : 10.0x leverage
```

### üîç –ê–Ω–∞–ª–∏–∑:

1. **Binance:** –†–∞–∑–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏–º–µ—é—Ç –†–ê–ó–ù–´–ô leverage (10x –∏–ª–∏ 20x)
2. **Bybit:** –í—Å–µ —Å–∏–º–≤–æ–ª—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –Ω–∞ 10x
3. **Leverage –ù–ï –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π** –¥–ª—è –≤—Å–µ—Ö —Å–∏–º–≤–æ–ª–æ–≤!
4. **Leverage –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –í–†–£–ß–ù–£–Æ** —á–µ—Ä–µ–∑ UI –±–∏—Ä–∂–∏

---

## üìö –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç CCXT —Å leverage

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è CCXT:

```python
# CCXT –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç set_leverage –¥–ª—è futures
binance.has['setLeverage']  # True
bybit.has['setLeverage']    # True

# –ù–æ –µ—Å–ª–∏ –ù–ï –≤—ã–∑–≤–∞—Ç—å set_leverage():
# ‚û°Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è leverage –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ –ë–ò–†–ñ–ï!
```

### –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```python
# –¢–∞–∫ –î–û–õ–ñ–ù–û –±—ã—Ç—å (–Ω–æ —É –Ω–∞—Å —ç—Ç–æ–≥–æ –ù–ï–¢):
await exchange.set_leverage(10, 'BTC/USDT:USDT')  # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å 10x –¥–ª—è BTCUSDT
await exchange.create_market_order('BTC/USDT:USDT', 'buy', 0.001)
```

### –ö–∞–∫ —Å–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –ë–û–¢:

```python
# –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
# ‚ùå –ù–ï–¢ set_leverage()!
await exchange.create_market_order('BTC/USDT:USDT', 'buy', 0.001)
# ‚û°Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è leverage —Å –±–∏—Ä–∂–∏ (–º–æ–∂–µ—Ç –±—ã—Ç—å 1x, 5x, 10x, 20x, 50x!)
```

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –†–ò–°–ö–ò

### 1. –ù–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å leverage

```
–ü—Ä–æ–±–ª–µ–º–∞: –†–∞–∑–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏–º–µ—é—Ç –†–ê–ó–ù–´–ô leverage!
          - –û–¥–∏–Ω —Å–∏–º–≤–æ–ª: 10x leverage
          - –î—Ä—É–≥–æ–π —Å–∏–º–≤–æ–ª: 20x leverage
          - –¢—Ä–µ—Ç–∏–π —Å–∏–º–≤–æ–ª: 1x leverage (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é!)

–†–∏—Å–∫:     –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —ç–∫—Å–ø–æ–∑–∏—Ü–∏—é!
```

### 2. –†–∏—Å–∫ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏

```
–°—Ü–µ–Ω–∞—Ä–∏–π: –°–∏–º–≤–æ–ª —Å–ª—É—á–∞–π–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ 50x leverage
          –ü–æ–∑–∏—Ü–∏—è $6 USD –ø—Ä–∏ 50x = —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è $300!
          –ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –Ω–∞ 2% = –ª–∏–∫–≤–∏–¥–∞—Ü–∏—è!

–¢–µ–∫—É—â–∏–π SL: 2% - —ç—Ç–æ–≥–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ù–ï–î–û–°–¢–ê–¢–û–ß–ù–û –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–º leverage!
```

### 3. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ä–∞—Å—á—ë—Ç–∞–º

```python
# config/settings.py
POSITION_SIZE_USD=6           # $6 –Ω–∞ –ø–æ–∑–∏—Ü–∏—é
MAX_POSITIONS=150             # 150 –ø–æ–∑–∏—Ü–∏–π
MAX_EXPOSURE_USD=30000        # $30K max

# –†–∞—Å—á—ë—Ç –ë–ï–ó leverage:
# 150 * $6 = $900 —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è

# –†–µ–∞–ª—å–Ω–æ—Å—Ç—å –° leverage 10x:
# 150 * $6 * 10x = $9,000 —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è! üö®

# –†–µ–∞–ª—å–Ω–æ—Å—Ç—å –° leverage 20x:
# 150 * $6 * 20x = $18,000 —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è! üö®üö®

# –†–µ–∞–ª—å–Ω–æ—Å—Ç—å –° mixed leverage (10x-20x):
# –ù–ï–ü–†–ï–î–°–ö–ê–ó–£–ï–ú–û! –ú–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç $9K –¥–æ $18K!
```

### 4. –ù–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã

```
–ü—Ä–æ–±–ª–µ–º–∞: –ö–∞–∂–¥—ã–π –Ω–æ–≤—ã–π —Å–∏–º–≤–æ–ª –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –í–†–£–ß–ù–£–Æ!
          –ï—Å–ª–∏ –∑–∞–±—ã—Ç—å - –±—É–¥–µ—Ç leverage 1x –∏–ª–∏ default –±–∏—Ä–∂–∏!

–†–∏—Å–∫:     –ë–æ—Ç –º–æ–∂–µ—Ç —Ç–æ—Ä–≥–æ–≤–∞—Ç—å —Å —Ä–∞–∑–Ω—ã–º leverage!
```

---

## üí° –ü–û–ß–ï–ú–£ LEVERAGE=10 –í .env –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:

```python
# config/settings.py - –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –ø–æ—Å—Ç—Ä–æ—á–Ω–æ
# ‚ùå –ù–ï–¢ –∑–∞–≥—Ä—É–∑–∫–∏ LEVERAGE –∏–∑ .env!

@dataclass
class TradingConfig:
    position_size_usd: Decimal = Decimal('200')
    max_positions: int = 10
    stop_loss_percent: Decimal = Decimal('2.0')
    # ...
    # ‚ùå –ù–ï–¢ –ø–æ–ª—è 'leverage'!
```

### –ì–¥–µ LEVERAGE —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è:

1. **`core/risk_manager.py:53`**
   ```python
   self.max_leverage = config.get('max_leverage', 10)
   ```
   ‚ùå –ù–û! RiskManager –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ main.py!

2. **WebSocket streams** - –ß–ò–¢–ê–Æ–¢ leverage –∏–∑ –±–∏—Ä–∂–µ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
   ```python
   # websocket/bybit_stream.py:126
   'leverage': float(position.get('leverage', 1))  # –ß—Ç–µ–Ω–∏–µ —Å –±–∏—Ä–∂–∏
   ```

3. **Scripts** - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è

**–í—ã–≤–æ–¥:** `LEVERAGE=10` –≤ .env - **–º—ë—Ä—Ç–≤–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è**! ‚úÖ –ú–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å.

---

## üõ†Ô∏è –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### ‚ö° –°–†–û–ß–ù–û (–ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏):

#### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å leverage –Ω–∞ –í–°–ï–• —Å–∏–º–≤–æ–ª–∞—Ö

```bash
# –ù—É–∂–µ–Ω —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞—É–¥–∏—Ç–∞:
python scripts/audit_leverage.py

# –î–æ–ª–∂–µ–Ω –ø–æ–∫–∞–∑–∞—Ç—å:
# Symbol          Exchange    Leverage    Status
# BTCUSDT         binance     20x         ‚ö†Ô∏è HIGH
# ETHUSDT         binance     10x         ‚úÖ OK
# NEWCOIN         binance     1x          ‚ùå TOO LOW
```

#### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ–¥–∏–Ω—ã–π leverage –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ

```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ ExchangeManager.initialize():

async def initialize(self):
    await self.exchange.load_markets()

    # üÜï –ù–û–í–û–ï: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å leverage –¥–ª—è –í–°–ï–• —Å–∏–º–≤–æ–ª–æ–≤
    target_leverage = 10  # –ò–∑ config

    for symbol in self.markets:
        if self.markets[symbol]['future']:  # –¢–æ–ª—å–∫–æ futures
            try:
                await self.exchange.set_leverage(target_leverage, symbol)
                logger.info(f"Set {target_leverage}x leverage for {symbol}")
            except Exception as e:
                logger.warning(f"Could not set leverage for {symbol}: {e}")
```

#### 3. –ü—Ä–æ–≤–µ—Ä—è—Ç—å leverage –ø–µ—Ä–µ–¥ –æ—Ç–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏

```python
# –í atomic_position_manager.py –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –æ—Ä–¥–µ—Ä–∞:

# üÜï –ù–û–í–û–ï: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ leverage
current_leverage = await self._get_symbol_leverage(exchange, symbol)
if current_leverage != self.target_leverage:
    logger.warning(
        f"‚ö†Ô∏è {symbol} leverage mismatch: "
        f"{current_leverage}x != {self.target_leverage}x, fixing..."
    )
    await exchange.set_leverage(self.target_leverage, symbol)
```

### üìã –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢:

#### 4. –î–æ–±–∞–≤–∏—Ç—å LEVERAGE –≤ config

```python
# config/settings.py

@dataclass
class TradingConfig:
    # ... existing fields ...

    # üÜï –ù–û–í–û–ï: Leverage control
    leverage: int = 10                    # Default leverage for all positions
    max_leverage: int = 20                # Maximum allowed leverage
    auto_set_leverage: bool = True        # Auto-set leverage on initialization
```

```python
# –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ .env:
if val := os.getenv('LEVERAGE'):
    config.leverage = int(val)
if val := os.getenv('MAX_LEVERAGE'):
    config.max_leverage = int(val)
if val := os.getenv('AUTO_SET_LEVERAGE'):
    config.auto_set_leverage = val.lower() == 'true'
```

#### 5. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ leverage

```python
# üÜï –ù–û–í–û–ï: –î–æ–±–∞–≤–∏—Ç—å –≤ monitoring/metrics.py

class MetricsCollector:
    def __init__(self):
        # ...
        self.position_leverage = Histogram(
            'position_leverage',
            'Leverage used for positions',
            ['exchange', 'symbol']
        )

    async def track_position_opened(self, position):
        # Get actual leverage from exchange
        leverage = await self._get_position_leverage(position)

        self.position_leverage.labels(
            exchange=position.exchange,
            symbol=position.symbol
        ).observe(leverage)
```

#### 6. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ –ø—Ä–µ-—á–µ–∫–∞—Ö

```python
# protection/position_guard.py

async def validate_leverage(self, symbol: str, exchange: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ leverage –≤ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø—Ä–µ–¥–µ–ª–∞—Ö"""
    current = await self._get_symbol_leverage(exchange, symbol)

    if current > self.config.max_leverage:
        logger.error(
            f"‚ùå {symbol} leverage {current}x exceeds max {self.config.max_leverage}x!"
        )
        return False

    if current < 1:
        logger.error(f"‚ùå {symbol} leverage {current}x is invalid!")
        return False

    return True
```

---

## üìä IMPACT ANALYSIS

### –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:

| –ê—Å–ø–µ–∫—Ç | –°—Ç–∞—Ç—É—Å | –†–∏—Å–∫ |
|--------|--------|------|
| **Leverage –∫–æ–Ω—Ç—Ä–æ–ª—å** | ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç | üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô |
| **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ** | ‚ùå –†–∞–∑–Ω—ã–π –ø–æ —Å–∏–º–≤–æ–ª–∞–º | üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô |
| **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å** | ‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ —ç–∫—Å–ø–æ–∑–∏—Ü–∏—è | üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô |
| **–ù–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã** | ‚ùå –¢—Ä–µ–±—É—é—Ç —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ | üü° –í–´–°–û–ö–ò–ô |
| **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** | ‚ùå –ù–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è | üü° –í–´–°–û–ö–ò–ô |

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

| –ê—Å–ø–µ–∫—Ç | –°—Ç–∞—Ç—É—Å | –†–∏—Å–∫ |
|--------|--------|------|
| **Leverage –∫–æ–Ω—Ç—Ä–æ–ª—å** | ‚úÖ –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π | üü¢ –ù–ò–ó–ö–ò–ô |
| **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏–µ** | ‚úÖ –ï–¥–∏–Ω—ã–π –¥–ª—è –≤—Å–µ—Ö | üü¢ –ù–ò–ó–ö–ò–ô |
| **–ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å** | ‚úÖ –ò–∑–≤–µ—Å—Ç–Ω–∞ –∑–∞—Ä–∞–Ω–µ–µ | üü¢ –ù–ò–ó–ö–ò–ô |
| **–ù–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã** | ‚úÖ –ê–≤—Ç–æ-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ | üü¢ –ù–ò–ó–ö–ò–ô |
| **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** | ‚úÖ Prometheus –º–µ—Ç—Ä–∏–∫–∏ | üü¢ –ù–ò–ó–ö–ò–ô |

---

## üéØ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### –§–∞–∑–∞ 1: –ê—É–¥–∏—Ç (–°–†–û–ß–ù–û - —Å–µ–≥–æ–¥–Ω—è)

- [ ] –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç `scripts/audit_leverage.py`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å leverage –Ω–∞ –í–°–ï–• —Ç–æ—Ä–≥—É–µ–º—ã—Ö —Å–∏–º–≤–æ–ª–∞—Ö (Binance + Bybit)
- [ ] –°–æ–∑–¥–∞—Ç—å –æ—Ç—á—ë—Ç: –∫–∞–∫–∏–µ —Å–∏–º–≤–æ–ª—ã –∏–º–µ—é—Ç –∫–∞–∫–æ–π leverage
- [ ] –í—ã—è–≤–∏—Ç—å –∞–Ω–æ–º–∞–ª–∏–∏ (—Å–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π/–Ω–∏–∑–∫–∏–π leverage)

### –§–∞–∑–∞ 2: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (1-2 –¥–Ω—è)

- [ ] –î–æ–±–∞–≤–∏—Ç—å `LEVERAGE`, `MAX_LEVERAGE`, `AUTO_SET_LEVERAGE` –≤ .env
- [ ] –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ `config/settings.py`
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `ExchangeManager.set_leverage_for_symbol()`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤—ã–∑–æ–≤ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ exchange
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –ø–æ–∑–∏—Ü–∏–∏

### –§–∞–∑–∞ 3: –í–∞–ª–∏–¥–∞—Ü–∏—è (1 –¥–µ–Ω—å)

- [ ] –î–æ–±–∞–≤–∏—Ç—å pre-check leverage –≤ `PositionGuard`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ `MetricsCollector`
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è leverage control
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ testnet

### –§–∞–∑–∞ 4: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (ongoing)

- [ ] Dashboard —Å leverage –ø–æ —Å–∏–º–≤–æ–ª–∞–º
- [ ] –ê–ª–µ—Ä—Ç—ã –ø—Ä–∏ leverage mismatch
- [ ] –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π –∞—É–¥–∏—Ç leverage –Ω–∞—Å—Ç—Ä–æ–µ–∫

---

## üìù –ü–†–ò–ú–ï–† –ö–û–î–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### 1. –î–æ–±–∞–≤–∏—Ç—å –≤ .env:

```bash
# Leverage Control
LEVERAGE=10                    # Default leverage for all symbols
MAX_LEVERAGE=20                # Maximum allowed leverage
AUTO_SET_LEVERAGE=true         # Auto-configure leverage on startup
```

### 2. –°–∫—Ä–∏–ø—Ç –¥–ª—è –∞—É–¥–∏—Ç–∞:

```python
#!/usr/bin/env python3
"""
Audit leverage settings across all exchanges
"""
import asyncio
from core.exchange_manager import ExchangeManager
from config.settings import config

async def audit_leverage():
    """Check leverage for all symbols"""

    results = {
        'binance': {},
        'bybit': {}
    }

    for exchange_name in ['binance', 'bybit']:
        cfg = config.get_exchange_config(exchange_name)
        if not cfg:
            continue

        em = ExchangeManager(exchange_name, cfg.__dict__)
        await em.initialize()

        # Get all futures symbols
        futures = [s for s, m in em.markets.items() if m.get('future')]

        print(f"\n{'=' * 80}")
        print(f"üìä {exchange_name.upper()} LEVERAGE AUDIT")
        print(f"{'=' * 80}\n")

        for symbol in futures[:50]:  # First 50
            try:
                # Method depends on exchange
                if exchange_name == 'binance':
                    risk = await em.exchange.fapiPrivateV2GetPositionRisk(
                        {'symbol': symbol.replace('/USDT:USDT', 'USDT')}
                    )
                    leverage = risk[0].get('leverage', 'N/A') if risk else 'N/A'
                else:  # bybit
                    positions = await em.exchange.fetch_positions(
                        symbols=[symbol],
                        params={'category': 'linear'}
                    )
                    leverage = positions[0].get('leverage', 'N/A') if positions else 'N/A'

                results[exchange_name][symbol] = leverage

                # Color code
                lev_int = int(float(leverage)) if leverage != 'N/A' else 0
                status = '‚úÖ' if 5 <= lev_int <= 15 else ('‚ö†Ô∏è' if lev_int > 15 else '‚ùå')

                print(f"{status} {symbol:25s}: {leverage}x")

            except Exception as e:
                print(f"‚ùå {symbol:25s}: ERROR - {e}")

        await em.close()

    # Summary
    print(f"\n{'=' * 80}")
    print("üìà SUMMARY")
    print(f"{'=' * 80}\n")

    for exchange, symbols in results.items():
        leverages = [float(v) for v in symbols.values() if v != 'N/A']
        if leverages:
            print(f"{exchange.upper()}:")
            print(f"  Min: {min(leverages)}x")
            print(f"  Max: {max(leverages)}x")
            print(f"  Avg: {sum(leverages)/len(leverages):.1f}x")
            print()

if __name__ == '__main__':
    asyncio.run(audit_leverage())
```

### 3. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ ExchangeManager:

```python
# core/exchange_manager.py

class ExchangeManager:

    async def initialize(self):
        """Load markets and validate connection"""
        await self.exchange.load_markets()
        logger.info(f"Loaded {len(self.markets)} markets from {self.name}")

        # üÜï –ù–û–í–û–ï: Auto-set leverage if enabled
        if self.config.get('auto_set_leverage', True):
            await self._configure_leverage()

        await self.exchange.fetch_balance()
        logger.info(f"Connection to {self.name} verified")

        return True

    async def _configure_leverage(self):
        """Set leverage for all futures symbols"""
        target_leverage = self.config.get('leverage', 10)

        futures_symbols = [
            symbol for symbol, market in self.markets.items()
            if market.get('future', False)
        ]

        logger.info(
            f"üîß Configuring {target_leverage}x leverage "
            f"for {len(futures_symbols)} symbols on {self.name}..."
        )

        success = 0
        failed = 0

        for symbol in futures_symbols:
            try:
                await self.rate_limiter.execute_request(
                    self.exchange.set_leverage,
                    target_leverage,
                    symbol
                )
                success += 1

                if success % 10 == 0:  # Progress update
                    logger.info(f"  Configured {success}/{len(futures_symbols)}...")

            except Exception as e:
                failed += 1
                logger.warning(f"  ‚ö†Ô∏è Could not set leverage for {symbol}: {e}")

        logger.info(
            f"‚úÖ Leverage configuration complete: "
            f"{success} success, {failed} failed"
        )
```

---

## ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ó–ê–í–ï–†–®–ï–ù–ò–Ø

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:

- [x] –ì–ª—É–±–æ–∫–∏–π –∞—É–¥–∏—Ç –≤—Å–µ—Ö —Ç–æ—á–µ–∫ —Å–æ–∑–¥–∞–Ω–∏—è –æ—Ä–¥–µ—Ä–æ–≤
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ params –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ä–¥–µ—Ä–æ–≤
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ exchange
- [x] –ü–æ–∏—Å–∫ set_leverage –≤—ã–∑–æ–≤–æ–≤
- [x] –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ leverage –Ω–∞ –±–∏—Ä–∂–∞—Ö
- [x] –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞

### –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

- [ ] –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∞—É–¥–∏—Ç–∞ leverage
- [ ] –î–æ–±–∞–≤–∏—Ç—å leverage –≤ config
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å auto-set leverage
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ testnet
- [ ] Deploy –≤ production

---

## üîö –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- ‚ùå Leverage –ù–ï –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ
- ‚ùå –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è leverage –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –í–†–£–ß–ù–£–Æ –Ω–∞ –±–∏—Ä–∂–µ
- ‚ùå –†–∞–∑–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã –∏–º–µ—é—Ç –†–ê–ó–ù–´–ô leverage
- ‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é —ç–∫—Å–ø–æ–∑–∏—Ü–∏—é
- ‚ùå LEVERAGE=10 –≤ .env –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ‚úÖ –ú–û–ñ–ù–û –£–î–ê–õ–ò–¢–¨

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üî¥ **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø** - –≤–ª–∏—è–µ—Ç –Ω–∞ —Ä–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç!

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
1. ‚ö° –°–†–û–ß–ù–û –ø—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç —Ç–µ–∫—É—â–∏—Ö leverage –Ω–∞—Å—Ç—Ä–æ–µ–∫
2. üõ†Ô∏è –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å leverage (1-2 –¥–Ω—è —Ä–∞–±–æ—Ç—ã)
3. üìä –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ leverage
4. ‚úÖ –£–¥–∞–ª–∏—Ç—å LEVERAGE=10 –∏–∑ .env (–ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)

---

**–ê–≤—Ç–æ—Ä:** Claude Code
**–î–∞—Ç–∞:** 2025-10-25
