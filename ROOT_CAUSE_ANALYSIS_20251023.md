# üîç –ê–ù–ê–õ–ò–ó –ö–û–†–ù–ï–í–û–ô –ü–†–ò–ß–ò–ù–´: –ü–æ—á–µ–º—É SL –¥–ª—è SHORT –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –Ω–∏–∂–µ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω—ã

## –î–∞—Ç–∞: 2025-10-23 20:30
## –°—Ç–∞—Ç—É—Å: ‚úÖ –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê –ù–ê–ô–î–ï–ù–ê

---

## üéØ –ù–ê–ô–î–ï–ù–ù–ê–Ø –ö–û–†–ù–ï–í–ê–Ø –ü–†–ò–ß–ò–ù–ê

### –ü—Ä–æ–±–ª–µ–º–∞ –≤ –ª–æ–≥–∏–∫–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è SL –¥–ª—è SHORT –ø–æ–∑–∏—Ü–∏–π

**–§–∞–π–ª:** `protection/trailing_stop.py`
**–ú–µ—Ç–æ–¥:** `_update_trailing_stop`
**–°—Ç—Ä–æ–∫–∏:** 596-601

```python
# For short: trail above lowest price
potential_stop = ts.lowest_price * (1 + distance / 100)

# Only update if new stop is lower than current
if potential_stop < ts.current_stop_price:
    new_stop_price = potential_stop
```

---

## üìä –°–¶–ï–ù–ê–†–ò–ô –í–û–ó–ù–ò–ö–ù–û–í–ï–ù–ò–Ø –ü–†–û–ë–õ–ï–ú–´

### –ü—Ä–∏–º–µ—Ä —Å SAROSUSDT (–∏–∑ –ª–æ–≥–æ–≤):

#### 1Ô∏è‚É£ –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (SHORT –ø–æ–∑–∏—Ü–∏—è):
- –í—Ö–æ–¥: 0.19000
- –¶–µ–Ω–∞ –ø–∞–¥–∞–µ—Ç –¥–æ: 0.17598
- lowest_price = 0.17598
- SL —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è: 0.18058 (0.17598 * 1.026)

#### 2Ô∏è‚É£ –¶–µ–Ω–∞ —Ä–∞—Å—Ç–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ:
- –ù–æ–≤–∞—è —Ü–µ–Ω–∞: 0.18334
- lowest_price –æ—Å—Ç–∞–µ—Ç—Å—è: 0.17598 (–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ–º –Ω–∞ —Ä–æ—Å—Ç–µ)
- current_price = 0.18334

#### 3Ô∏è‚É£ –ü–æ–ø—ã—Ç–∫–∞ –æ–±–Ω–æ–≤–∏—Ç—å SL:
- –†–∞—Å—á–µ—Ç: potential_stop = 0.17598 * 1.02 = 0.17686
- –ü—Ä–æ–≤–µ—Ä–∫–∞: 0.17686 < 0.18058 (—Å—Ç–∞—Ä—ã–π SL) ‚Üí TRUE
- **–û–®–ò–ë–ö–ê:** –ü—ã—Ç–∞–µ–º—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SL = 0.17686

#### 4Ô∏è‚É£ –†–µ–∑—É–ª—å—Ç–∞—Ç:
- SL (0.17686) < —Ç–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ (0.18334)
- Bybit –æ—Ç–∫–ª–æ–Ω—è–µ—Ç: "StopLoss for Sell position should greater base_price"

---

## üî¥ –í –ß–ï–ú –û–®–ò–ë–ö–ê –õ–û–ì–ò–ö–ò

### –¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ (–ù–ï–í–ï–†–ù–ê–Ø):
```
–î–ª—è SHORT: –ï—Å–ª–∏ potential_stop < current_stop ‚Üí –æ–±–Ω–æ–≤–∏—Ç—å SL
```

### –ü—Ä–æ–±–ª–µ–º–∞:
- –ü—Ä–∏ —Ä–æ—Å—Ç–µ —Ü–µ–Ω—ã trailing distance –º–æ–∂–µ—Ç —É–º–µ–Ω—å—à–∞—Ç—å—Å—è
- –≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –ø–æ–ø—ã—Ç–∫–µ –ü–û–ù–ò–ó–ò–¢–¨ SL
- –ù–æ –¥–ª—è SHORT –ø–æ–Ω–∏–∂–∞—Ç—å SL –ø—Ä–∏ —Ä–æ—Å—Ç–µ —Ü–µ–Ω—ã - —ç—Ç–æ –¥–≤–∏–∂–µ–Ω–∏–µ –ü–†–û–¢–ò–í –ø–æ–∑–∏—Ü–∏–∏!

### –ü—Ä–∏–º–µ—Ä:
- –ë—ã–ª–æ: distance = 2.6%, SL = 0.17598 * 1.026 = 0.18058
- –°—Ç–∞–ª–æ: distance = 2.0%, SL = 0.17598 * 1.020 = 0.17686
- –ü–æ–ø—ã—Ç–∫–∞ –ø–æ–Ω–∏–∑–∏—Ç—å SL —Å 0.18058 –¥–æ 0.17686

---

## ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –õ–û–ì–ò–ö–ê

### –î–ª—è SHORT –ø–æ–∑–∏—Ü–∏–π:
1. **–ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ü–µ–Ω—ã:**
   - –û–±–Ω–æ–≤–ª—è–µ–º lowest_price
   - –û–ø—É—Å–∫–∞–µ–º SL —Å–ª–µ–¥–æ–º (—Ñ–∏–∫—Å–∞—Ü–∏—è –ø—Ä–∏–±—ã–ª–∏)

2. **–ü—Ä–∏ —Ä–æ—Å—Ç–µ —Ü–µ–Ω—ã:**
   - lowest_price –ù–ï –º–µ–Ω—è–µ—Ç—Å—è
   - SL –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞—Ç—å—Å—è –Ω–∞ –º–µ—Å—Ç–µ –∏–ª–∏ –ü–û–î–ù–Ø–¢–¨–°–Ø (–Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –æ–ø—É—Å–∫–∞—Ç—å—Å—è!)

### –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ:
```python
# –î–ª—è SHORT: –æ–±–Ω–æ–≤–ª—è–µ–º SL —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –æ–Ω —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ù–ò–ñ–ï –ø—Ä–∏ –ü–ê–î–ï–ù–ò–ò —Ü–µ–Ω—ã
if ts.current_price < ts.lowest_price:  # –¶–µ–Ω–∞ —É–ø–∞–ª–∞
    potential_stop = ts.lowest_price * (1 + distance / 100)
    if potential_stop < ts.current_stop_price:
        new_stop_price = potential_stop
# –ò–Ω–∞—á–µ SL –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ
```

---

## üõ†Ô∏è –í–ê–†–ò–ê–ù–¢–´ –†–ï–®–ï–ù–ò–Ø

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —É—Å–ª–æ–≤–∏–µ –≤ trailing_stop (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –£—Å—Ç—Ä–∞–Ω—è–µ—Ç –∫–æ—Ä–Ω–µ–≤—É—é –ø—Ä–∏—á–∏–Ω—É
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –≠–∫–æ–Ω–æ–º–∏—Ç —Ä–µ—Å—É—Ä—Å—ã (–Ω–µ –¥–µ–ª–∞–µ–º –ª–∏—à–Ω–∏—Ö –≤—ã–∑–æ–≤–æ–≤ API)

**–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ trailing_stop.py (—Å—Ç—Ä–æ–∫–∞ ~596-601):**
```python
else:  # SHORT –ø–æ–∑–∏—Ü–∏—è
    # For short: trail above lowest price
    potential_stop = ts.lowest_price * (1 + distance / 100)

    # CRITICAL: Only update if price is falling AND new stop is lower
    # Never lower stop when price is rising for SHORT!
    if ts.current_price <= ts.lowest_price:  # –¶–µ–Ω–∞ –Ω–∞ –º–∏–Ω–∏–º—É–º–µ –∏–ª–∏ –Ω–∏–∂–µ
        if potential_stop < ts.current_stop_price:
            new_stop_price = potential_stop
    # –ï—Å–ª–∏ —Ü–µ–Ω–∞ —Ä–∞—Å—Ç–µ—Ç - SL –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–∞ –º–µ—Å—Ç–µ
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ exchange_manager (–∑–∞–ø–∞—Å–Ω–æ–π)
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ –º–µ–Ω—è–µ—Ç –ª–æ–≥–∏–∫—É trailing_stop
- –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∑–∞—â–∏—Ç–Ω–∞—è —Å–µ—Ç–∫–∞

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ù–µ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –∫–æ—Ä–Ω–µ–≤—É—é –ø—Ä–∏—á–∏–Ω—É
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ª–∏—à–Ω–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –ó–∞–≥—Ä—è–∑–Ω—è–µ—Ç –ª–æ–≥–∏ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏

---

## üìà –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø –ü–†–û–ë–õ–ï–ú–´

```
SHORT –ø–æ–∑–∏—Ü–∏—è SAROSUSDT:

     0.19000  ‚Üê –í—Ö–æ–¥ (–ø—Ä–æ–¥–∞–ª–∏)
        |
     0.18334  ‚Üê –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ (–ø–æ–¥–Ω—è–ª–∞—Å—å) ‚ö†Ô∏è
     0.18058  ‚Üê –¢–µ–∫—É—â–∏–π SL (–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)
     0.17686  ‚Üê –ü–æ–ø—ã—Ç–∫–∞ –Ω–æ–≤–æ–≥–æ SL (–û–®–ò–ë–ö–ê! –ù–∏–∂–µ —Ü–µ–Ω—ã!)
        |
     0.17598  ‚Üê lowest_price (–º–∏–Ω–∏–º—É–º)
```

---

## üéØ –í–´–í–û–î–´

1. **–ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞:** Trailing stop –ø—ã—Ç–∞–µ—Ç—Å—è –ü–û–ù–ò–ó–ò–¢–¨ SL –¥–ª—è SHORT –ø—Ä–∏ —É–º–µ–Ω—å—à–µ–Ω–∏–∏ trailing distance, –¥–∞–∂–µ –∫–æ–≥–¥–∞ —Ü–µ–Ω–∞ —Ä–∞—Å—Ç–µ—Ç

2. **–ü–æ—á–µ–º—É –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –£—Å–ª–æ–≤–∏–µ `if potential_stop < ts.current_stop_price` –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è —Ü–µ–Ω—ã

3. **–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã - –æ–±–Ω–æ–≤–ª—è—Ç—å SL –¥–ª—è SHORT —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ü–µ–Ω—ã

4. **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –≤ exchange_manager (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

---

## üìã –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
1. ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ trailing_stop.py
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ exchange_manager –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –∑–∞—â–∏—Ç—É
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è —ç—Ç–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è—Ö SL
3. –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—é –¥–≤–∏–∂–µ–Ω–∏—è SL –≤ –ª–æ–≥–∞—Ö

---

**–ê–≤—Ç–æ—Ä:** AI Assistant
**–î–∞—Ç–∞:** 2025-10-23
**–í–µ—Ä—Å–∏—è:** 1.0