# ‚úÖ DEBUG –õ–û–ì–ò –í–ö–õ–Æ–ß–ï–ù–´

**–î–∞—Ç–∞:** 2025-10-18 15:00
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Æ

---

## üìù –ò–ó–ú–ï–ù–ï–ù–ò–Ø

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω main.py (—Å—Ç—Ä–æ–∫–∞ 30)

**–ë—ã–ª–æ (–∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–æ):**
```python
level=logging.INFO,
```

**–°—Ç–∞–ª–æ (—á–∏—Ç–∞–µ—Ç –∏–∑ .env):**
```python
level=getattr(logging, os.getenv('LOG_LEVEL', 'INFO')),
```

**Backup:**
```
main.py.backup.20251018_150055_before_loglevel_fix
```

### 2. –ò–∑–º–µ–Ω–µ–Ω .env (—Å—Ç—Ä–æ–∫–∞ 70)

**–ë—ã–ª–æ:**
```
LOG_LEVEL=INFO
```

**–°—Ç–∞–ª–æ:**
```
LOG_LEVEL=DEBUG
```

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ò

### 1. Backup —Å–æ–∑–¥–∞–Ω
```bash
‚úÖ main.py.backup.20251018_150055_before_loglevel_fix exists
```

### 2. –°–∏–Ω—Ç–∞–∫—Å–∏—Å Python
```bash
$ python3 -c "import main"
‚úÖ No errors
```

### 3. –ò–∑–º–µ–Ω–µ–Ω–∏—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ
```bash
‚úÖ main.py: –∏–∑–º–µ–Ω–µ–Ω–∞ 1 —Å—Ç—Ä–æ–∫–∞ (30)
‚úÖ .env: –∏–∑–º–µ–Ω–µ–Ω–∞ 1 —Å—Ç—Ä–æ–∫–∞ (70)
‚úÖ –õ–æ–≥–∏–∫–∞ –ù–ï –∏–∑–º–µ–Ω–µ–Ω–∞
‚úÖ Golden Rule —Å–æ–±–ª—é–¥—ë–Ω
```

---

## üéØ –ß–¢–û –¢–ï–ü–ï–†–¨ –ë–£–î–ï–¢

### –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞:

**1. Startup (–∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–∑–∏—Ü–∏–π):**
```
DEBUG - üìä Loaded 82 positions from database
DEBUG -    ‚úÖ Loaded: FORTHUSDT on binance (id=854)
DEBUG -    ‚úÖ Loaded: LDOUSDT on binance (id=855)
DEBUG -    ‚úÖ Loaded: ALGOUSDT on binance (id=XXX)
DEBUG -    ...
DEBUG -    Loaded symbols: ['1000CHEEMSUSDT', ..., 'ALGOUSDT', ...]
```

**–¢–µ–ø–µ—Ä—å —É–≤–∏–¥–∏–º:**
- –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- ID –∫–∞–∂–¥–æ–π –ø–æ–∑–∏—Ü–∏–∏
- –ë—ã–ª –ª–∏ ALGOUSDT (–∏ –¥—Ä—É–≥–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã) –∑–∞–≥—Ä—É–∂–µ–Ω

---

**2. Wave Processing (–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤):**
```
DEBUG - üîç has_open_position(symbol='ALGOUSDT', exchange='binance')
DEBUG -    Cache size: 82 positions
DEBUG -    ‚ùå Not in cache, checking DB/exchange via _position_exists()...
DEBUG - üîç _position_exists(symbol='ALGOUSDT', exchange='binance')
DEBUG -    Step 1/3: Checking cache...
DEBUG -    ‚ùå Not in cache
DEBUG -    Step 2/3: Checking database...
DEBUG -    ‚ùå Not in DB
DEBUG -    Step 3/3: Checking exchange API...
DEBUG -    ‚ùå Not on exchange
DEBUG -    Final result: FALSE (not found anywhere)
DEBUG -    _position_exists() returned: FALSE
```

**–¢–µ–ø–µ—Ä—å —É–≤–∏–¥–∏–º:**
- –ë—ã–ª –ª–∏ —Å–∏–º–≤–æ–ª –≤ –∫—ç—à–µ
- –í—ã–∑—ã–≤–∞–ª—Å—è –ª–∏ _position_exists()
- –ü—Ä–æ–≤–µ—Ä—è–ª–∞—Å—å –ª–∏ –ë–î
- –ß—Ç–æ –≤–µ—Ä–Ω—É–ª–∞ –∫–∞–∂–¥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

---

**3. Position Manager (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–∞):**
```
WARNING - Position already exists for ALGOUSDT on binance
DEBUG - üîç _position_exists(symbol='ALGOUSDT', exchange='binance')
DEBUG -    Step 1/3: Checking cache...
DEBUG -    ‚ùå Not in cache
DEBUG -    Step 2/3: Checking database...
DEBUG -    ‚úÖ Found in DB: position_id=874
```

**–¢–µ–ø–µ—Ä—å —É–≤–∏–¥–∏–º:**
- –ü–æ—á–µ–º—É –Ω–∞—à—ë–ª –≤ –ë–î (position_id)
- –ü–æ—á–µ–º—É –ù–ï –Ω–∞—à—ë–ª –≤ –∫—ç—à–µ
- –†–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –¥–≤—É–º—è –≤—ã–∑–æ–≤–∞–º–∏

---

## üîç –ê–ù–ê–õ–ò–ó –ö–û–¢–û–†–´–ô –°–¢–ê–ù–ï–¢ –í–û–ó–ú–û–ñ–ù–´–ú

### –°—Ü–µ–Ω–∞—Ä–∏–π A: –ü–æ–∑–∏—Ü–∏—è –ù–ï –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

**–ï—Å–ª–∏ —É–≤–∏–¥–∏–º:**
```
DEBUG - Loaded symbols: [...] (–Ω–µ—Ç ALGOUSDT)
```

**–¢–æ–≥–¥–∞ –ø—Ä–æ–±–ª–µ–º–∞:** –ü–æ–∑–∏—Ü–∏—è –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å ‚Üí –Ω—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å –ø–æ—á–µ–º—É
- verify_position_exists() failed?
- PHANTOM detection?
- Symbol normalization issue?

---

### –°—Ü–µ–Ω–∞—Ä–∏–π B: –ü–æ–∑–∏—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –Ω–æ —É–¥–∞–ª–∏–ª–∞—Å—å –∏–∑ –∫—ç—à–∞

**–ï—Å–ª–∏ —É–≤–∏–¥–∏–º:**
```
DEBUG - Loaded symbols: [..., 'ALGOUSDT', ...]  (–µ—Å—Ç—å –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ)
DEBUG - has_open_position() ‚Üí Cache size: 82   (–µ—Å—Ç—å –≤ –∫—ç—à–µ)
DEBUG - Not in cache                            (–Ω–æ –Ω–µ –Ω–∞—à–ª–∏!)
```

**–¢–æ–≥–¥–∞ –ø—Ä–æ–±–ª–µ–º–∞:** –ë–∞–≥ –≤ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫—ç—à–∞ ‚Üí –ª–æ–≥–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞

---

### –°—Ü–µ–Ω–∞—Ä–∏–π C: –ë–î query –¥–∞—ë—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å–±–æ–π

**–ï—Å–ª–∏ —É–≤–∏–¥–∏–º:**
```
07:22:04 - _position_exists() ‚Üí Step 2/3: ‚ùå Not in DB
07:22:11 - _position_exists() ‚Üí Step 2/3: ‚úÖ Found in DB: position_id=874
```

**–¢–æ–≥–¥–∞ –ø—Ä–æ–±–ª–µ–º–∞:** –ë–î connection/timeout/transaction isolation

---

### –°—Ü–µ–Ω–∞—Ä–∏–π D: _position_exists() –ù–ï –≤—ã–∑—ã–≤–∞–ª—Å—è

**–ï—Å–ª–∏ —É–≤–∏–¥–∏–º:**
```
DEBUG - has_open_position()
DEBUG -    Cache size: 82 positions
(–ù–ï–¢ —Å—Ç—Ä–æ–∫–∏ "_position_exists() returned:")
```

**–¢–æ–≥–¥–∞ –ø—Ä–æ–±–ª–µ–º–∞:** –ë–∞–≥ –≤ has_open_position() - –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç _position_exists()

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–π –±–æ—Ç (Ctrl+C)
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–Ω–æ–≤–∞
python main.py 2>&1 | tee monitoring_logs/bot_$(date +%Y%m%d_%H%M%S).log
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DEBUG –ª–æ–≥–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
```bash
# –°—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å
tail -f monitoring_logs/bot_*.log | grep "DEBUG"

# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
# DEBUG - ‚úÖ Loaded: FORTHUSDT on binance (id=854)
# DEBUG - ‚úÖ Loaded: LDOUSDT on binance (id=855)
# ...
```

### 3. –î–æ–∂–¥–∞—Ç—å—Å—è —Å–ª–µ–¥—É—é—â–µ–π –≤–æ–ª–Ω—ã
- –û—Å–æ–±–µ–Ω–Ω–æ –≤–æ–ª–Ω—ã —Å –¥—É–±–ª–∏–∫–∞—Ç–∞–º–∏
- –ò–ª–∏ —Å–æ–∑–¥–∞—Ç—å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –¥—É–±–ª–∏–∫–∞—Ç (–ø–æ—Å–ª–∞—Ç—å —Å–∏–≥–Ω–∞–ª –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ø–æ–∑–∏—Ü–∏–∏)

### 4. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å DEBUG –ª–æ–≥–∏
```bash
# –ù–∞–π—Ç–∏ –≤—Å–µ –≤—ã–∑–æ–≤—ã has_open_position
grep "üîç has_open_position" monitoring_logs/bot_*.log

# –ù–∞–π—Ç–∏ –≤—Å–µ –≤—ã–∑–æ–≤—ã _position_exists
grep "üîç _position_exists" monitoring_logs/bot_*.log

# –ù–∞–π—Ç–∏ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ë–î
grep "Step 2/3:" monitoring_logs/bot_*.log
```

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –†–∞–∑–º–µ—Ä –ª–æ–≥–æ–≤

**DEBUG –ª–æ–≥–∏ –û–ß–ï–ù–¨ –º–Ω–æ–≥–æ—Å–ª–æ–≤–Ω—ã!**

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä:
- INFO –ª–æ–≥–∏: ~100 MB –∑–∞ 8 —á–∞—Å–æ–≤
- **DEBUG –ª–æ–≥–∏: ~500-1000 MB –∑–∞ 8 —á–∞—Å–æ–≤** (–≤ 5-10 —Ä–∞–∑ –±–æ–ª—å—à–µ!)

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–ù–µ –æ—Å—Ç–∞–≤–ª—è—Ç—å DEBUG –Ω–∞–¥–æ–ª–≥–æ** - —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
2. –ü–æ—Å–ª–µ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã - –≤–µ—Ä–Ω—É—Ç—å LOG_LEVEL=INFO
3. –í–æ–∑–º–æ–∂–Ω–æ –ª–æ–≥–∏ –∑–∞–ø–æ–ª–Ω—è—Ç –¥–∏—Å–∫ - —Å–ª–µ–¥–∏—Ç—å –∑–∞ –º–µ—Å—Ç–æ–º

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ:
```bash
df -h .
du -sh monitoring_logs/
```

---

## üîÑ –û–¢–ö–ê–¢ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### –í–µ—Ä–Ω—É—Ç—å INFO –ª–æ–≥–∏:

**–í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ—Å—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å .env**
```bash
# –í .env –∏–∑–º–µ–Ω–∏—Ç—å:
LOG_LEVEL=INFO

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ä—ã–π main.py**
```bash
cp main.py.backup.20251018_150055_before_loglevel_fix main.py

# –í .env –∏–∑–º–µ–Ω–∏—Ç—å:
LOG_LEVEL=INFO

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
```

---

## üìä –û–ñ–ò–î–ê–ï–ú–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ï—Å–ª–∏ DEBUG –ª–æ–≥–∏ –ø–æ–∫–∞–∂—É—Ç –ø—Ä–æ–±–ª–µ–º—É:

**–°—Ü–µ–Ω–∞—Ä–∏–π A - –ü–æ–∑–∏—Ü–∏–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è:**
‚Üí –ò—Å–ø—Ä–∞–≤–∏–º verify_position_exists()

**–°—Ü–µ–Ω–∞—Ä–∏–π B - –ë–∞–≥ –≤ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫—ç—à–∞:**
‚Üí –ò—Å–ø—Ä–∞–≤–∏–º has_open_position()

**–°—Ü–µ–Ω–∞—Ä–∏–π C - –ë–î query fails:**
‚Üí –î–æ–±–∞–≤–∏–º retry logic –∏–ª–∏ —É–≤–µ–ª–∏—á–∏–º timeout

**–°—Ü–µ–Ω–∞—Ä–∏–π D - _position_exists() –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è:**
‚Üí –ò—Å–ø—Ä–∞–≤–∏–º –ª–æ–≥–∏–∫—É –≤ has_open_position()

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
1. –í–µ—Ä–Ω—ë–º LOG_LEVEL=INFO
2. –£–¥–∞–ª–∏–º DEBUG –ª–æ–≥–∏ –∏–∑ –∫–æ–¥–∞ (–µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω—ã)
3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º 24 —á–∞—Å–∞
4. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏–º —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞

---

## ‚úÖ –°–¢–ê–¢–£–°

**main.py:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω (—á–∏—Ç–∞–µ—Ç LOG_LEVEL –∏–∑ env)
**LOG_LEVEL:** ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ DEBUG
**Backup:** ‚úÖ –°–æ–∑–¥–∞–Ω
**–°–∏–Ω—Ç–∞–∫—Å–∏—Å:** ‚úÖ –í–∞–ª–∏–¥–µ–Ω
**–ì–æ—Ç–æ–≤–æ –∫ –∑–∞–ø—É—Å–∫—É:** ‚úÖ –î–ê

**–°–ª–µ–¥—É—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ:** –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –∏ –∂–¥–∞—Ç—å DEBUG –ª–æ–≥–æ–≤

---

**–ü—Ä–∏–º–µ–Ω–∏–ª:** Claude Code
**–î–∞—Ç–∞:** 2025-10-18 15:00
**–¶–µ–ª—å:** –í–∫–ª—é—á–∏—Ç—å DEBUG –ª–æ–≥–∏ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ CRITICAL

---
