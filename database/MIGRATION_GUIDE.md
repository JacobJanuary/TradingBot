# üìö –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏—è–º –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç `apply_migrations.py` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç SQL –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä (Dry-Run)

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∫–∞–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –ë–ï–ó –∏–∑–º–µ–Ω–µ–Ω–∏—è –ë–î:

```bash
cd /Users/evgeniyyanvarskiy/PycharmProjects/TradingBot
python database/apply_migrations.py --dry-run
```

### 2. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –≤—Å–µ pending –º–∏–≥—Ä–∞—Ü–∏–∏:

```bash
python database/apply_migrations.py
```

## üìã –¢–µ–∫—É—â–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### ‚úÖ add_exit_reason_column.sql
**–ö—Ä–∏—Ç–∏—á–Ω–æ!** –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `exit_reason` –≤ —Ç–∞–±–ª–∏—Ü—É `monitoring.positions`

- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –•—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ–∑–∏—Ü–∏–∏ (SL, TP, manual, PHANTOM_CLEANUP)
- **–í–ª–∏—è–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–ª—è–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –±–∞–≥ —Å –∑–∞–∫—Ä—ã—Ç–∏–µ–º –ø–æ–∑–∏—Ü–∏–π
- **–°—Å—ã–ª–∫–∞**: CRITICAL_BUG_REPORT_20251004.md

### ‚úÖ add_realized_pnl_column.sql
–î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ `realized_pnl` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–π –ø—Ä–∏–±—ã–ª–∏

### ‚úÖ fix_field_sync.sql
–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø–æ–ª–µ–π –º–µ–∂–¥—É –∫–æ–¥–æ–º –∏ –ë–î

### ‚úÖ add_missing_position_fields.sql
–î–æ–±–∞–≤–ª—è–µ—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### ‚úÖ create_processed_signals_table.sql
–°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤

## üîç –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É `monitoring.applied_migrations`:

```sql
SELECT * FROM monitoring.applied_migrations ORDER BY applied_at DESC;
```

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

1. **–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è**: –ü–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –º–∏–≥—Ä–∞—Ü–∏–π —Å–¥–µ–ª–∞–π—Ç–µ backup –ë–î:
   ```bash
   pg_dump -h localhost -p 5433 -U elcrypto fox_crypto > backup_$(date +%Y%m%d_%H%M%S).sql
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∫–∞**: –í—Å–µ–≥–¥–∞ —Å–Ω–∞—á–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--dry-run`

3. **–û—Ç–∫–∞—Ç**: –í —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏–∑ backup:
   ```bash
   psql -h localhost -p 5433 -U elcrypto fox_crypto < backup_20251004_120000.sql
   ```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
psql -h localhost -p 5433 -U elcrypto -d fox_crypto -c "SELECT version();"
```

### –ú–∏–≥—Ä–∞—Ü–∏—è –ø–æ–º–µ—á–µ–Ω–∞ –∫–∞–∫ failed

```sql
-- –°–±—Ä–æ—Å—å—Ç–µ —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏
UPDATE monitoring.applied_migrations 
SET status = 'pending' 
WHERE migration_file = '–∏–º—è_—Ñ–∞–π–ª–∞.sql';

-- –ò–ª–∏ —É–¥–∞–ª–∏—Ç–µ –∑–∞–ø–∏—Å—å –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
DELETE FROM monitoring.applied_migrations 
WHERE migration_file = '–∏–º—è_—Ñ–∞–π–ª–∞.sql';
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. –õ–æ–≥–∏: `logs/trading_bot.log`
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î: `.env` —Ñ–∞–π–ª
3. –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: `SELECT pg_is_in_recovery();`

